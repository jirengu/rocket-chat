{"version":3,"sources":["meteor://ðŸ’»app/server/lib/cordova/facebook-login.js","meteor://ðŸ’»app/server/lib/accounts.js","meteor://ðŸ’»app/server/lib/cordova.js","meteor://ðŸ’»app/server/startup/migrations/v001.js","meteor://ðŸ’»app/server/startup/migrations/v002.js","meteor://ðŸ’»app/server/startup/migrations/v003.js","meteor://ðŸ’»app/server/startup/migrations/v004.js","meteor://ðŸ’»app/server/startup/migrations/v005.js","meteor://ðŸ’»app/server/startup/migrations/v006.js","meteor://ðŸ’»app/server/startup/migrations/v007.js","meteor://ðŸ’»app/server/startup/migrations/v008.js","meteor://ðŸ’»app/server/startup/migrations/v009.js","meteor://ðŸ’»app/server/startup/migrations/v010.js","meteor://ðŸ’»app/server/startup/migrations/v011.js","meteor://ðŸ’»app/server/startup/migrations/v012.js","meteor://ðŸ’»app/server/startup/migrations/v013.js","meteor://ðŸ’»app/server/startup/migrations/v014.js","meteor://ðŸ’»app/server/startup/migrations/v015.js","meteor://ðŸ’»app/server/startup/migrations/v016.js","meteor://ðŸ’»app/server/startup/migrations/v017.js","meteor://ðŸ’»app/server/startup/migrations/v018.js","meteor://ðŸ’»app/server/startup/migrations/v019.js","meteor://ðŸ’»app/server/startup/migrations/v020.js","meteor://ðŸ’»app/server/startup/migrations/v021.js","meteor://ðŸ’»app/server/startup/migrations/v022.js","meteor://ðŸ’»app/server/startup/migrations/v023.js","meteor://ðŸ’»app/server/startup/migrations/v024.js","meteor://ðŸ’»app/server/startup/migrations/v025.js","meteor://ðŸ’»app/server/startup/migrations/v026.js","meteor://ðŸ’»app/server/startup/migrations/v027.js","meteor://ðŸ’»app/server/startup/migrations/v028.js","meteor://ðŸ’»app/server/startup/migrations/v029.js","meteor://ðŸ’»app/server/startup/migrations/v030.js","meteor://ðŸ’»app/server/startup/migrations/v031.js","meteor://ðŸ’»app/server/startup/migrations/v032.js","meteor://ðŸ’»app/server/startup/migrations/v033.js","meteor://ðŸ’»app/server/startup/migrations/v034.js","meteor://ðŸ’»app/server/startup/migrations/v035.js","meteor://ðŸ’»app/server/startup/migrations/v036.js","meteor://ðŸ’»app/server/startup/migrations/v037.js","meteor://ðŸ’»app/server/startup/migrations/v038.js","meteor://ðŸ’»app/server/startup/migrations/v039.js","meteor://ðŸ’»app/server/startup/migrations/v040.js","meteor://ðŸ’»app/server/startup/migrations/v041.js","meteor://ðŸ’»app/server/startup/migrations/v042.js","meteor://ðŸ’»app/server/startup/migrations/v043.js","meteor://ðŸ’»app/server/startup/migrations/v044.js","meteor://ðŸ’»app/server/startup/migrations/v045.js","meteor://ðŸ’»app/server/startup/migrations/v046.js","meteor://ðŸ’»app/server/startup/migrations/v047.js","meteor://ðŸ’»app/server/startup/migrations/v048.js","meteor://ðŸ’»app/server/startup/migrations/v049.js","meteor://ðŸ’»app/server/startup/migrations/v050.js","meteor://ðŸ’»app/server/startup/migrations/v051.js","meteor://ðŸ’»app/server/startup/migrations/v052.js","meteor://ðŸ’»app/server/startup/migrations/v053.js","meteor://ðŸ’»app/server/startup/migrations/v054.js","meteor://ðŸ’»app/server/startup/migrations/v055.js","meteor://ðŸ’»app/server/startup/migrations/v056.js","meteor://ðŸ’»app/server/startup/migrations/v057.js","meteor://ðŸ’»app/server/startup/migrations/v058.js","meteor://ðŸ’»app/server/startup/migrations/v059.js","meteor://ðŸ’»app/server/startup/migrations/v060.js","meteor://ðŸ’»app/server/startup/migrations/v061.js","meteor://ðŸ’»app/server/startup/migrations/v062.js","meteor://ðŸ’»app/server/startup/migrations/v063.js","meteor://ðŸ’»app/server/startup/migrations/v064.js","meteor://ðŸ’»app/server/startup/migrations/v065.js","meteor://ðŸ’»app/server/startup/migrations/v066.js","meteor://ðŸ’»app/server/startup/migrations/v067.js","meteor://ðŸ’»app/server/startup/migrations/v068.js","meteor://ðŸ’»app/server/startup/migrations/v069.js","meteor://ðŸ’»app/server/startup/migrations/v070.js","meteor://ðŸ’»app/server/startup/migrations/v071.js","meteor://ðŸ’»app/server/startup/migrations/v072.js","meteor://ðŸ’»app/server/startup/migrations/v073.js","meteor://ðŸ’»app/server/startup/migrations/v074.js","meteor://ðŸ’»app/server/startup/migrations/v075.js","meteor://ðŸ’»app/server/startup/migrations/v076.js","meteor://ðŸ’»app/server/startup/migrations/v077.js","meteor://ðŸ’»app/server/startup/migrations/v078.js","meteor://ðŸ’»app/server/startup/migrations/v079.js","meteor://ðŸ’»app/server/startup/migrations/v080.js","meteor://ðŸ’»app/server/startup/migrations/v081.js","meteor://ðŸ’»app/server/startup/migrations/v082.js","meteor://ðŸ’»app/server/startup/migrations/v083.js","meteor://ðŸ’»app/server/startup/migrations/v084.js","meteor://ðŸ’»app/server/startup/migrations/v085.js","meteor://ðŸ’»app/server/startup/migrations/v086.js","meteor://ðŸ’»app/server/startup/migrations/v087.js","meteor://ðŸ’»app/server/startup/migrations/v088.js","meteor://ðŸ’»app/server/startup/migrations/v089.js","meteor://ðŸ’»app/server/startup/migrations/xrun.js","meteor://ðŸ’»app/server/startup/appcache.js","meteor://ðŸ’»app/server/startup/avatar.js","meteor://ðŸ’»app/server/startup/cron.js","meteor://ðŸ’»app/server/startup/i18n-validation.js","meteor://ðŸ’»app/server/startup/initialData.js","meteor://ðŸ’»app/server/startup/presence.js","meteor://ðŸ’»app/server/startup/roomPublishes.js","meteor://ðŸ’»app/server/startup/serverRunning.js","meteor://ðŸ’»app/server/configuration/accounts_meld.js","meteor://ðŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ðŸ’»app/server/methods/addAllUserToRoom.js","meteor://ðŸ’»app/server/methods/addRoomModerator.js","meteor://ðŸ’»app/server/methods/addRoomOwner.js","meteor://ðŸ’»app/server/methods/canAccessRoom.js","meteor://ðŸ’»app/server/methods/channelsList.js","meteor://ðŸ’»app/server/methods/createDirectMessage.js","meteor://ðŸ’»app/server/methods/deleteFileMessage.js","meteor://ðŸ’»app/server/methods/deleteUser.js","meteor://ðŸ’»app/server/methods/eraseRoom.js","meteor://ðŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ðŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ðŸ’»app/server/methods/getTotalChannels.js","meteor://ðŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ðŸ’»app/server/methods/getUsersOfRoom.js","meteor://ðŸ’»app/server/methods/groupsList.js","meteor://ðŸ’»app/server/methods/hideRoom.js","meteor://ðŸ’»app/server/methods/loadHistory.js","meteor://ðŸ’»app/server/methods/loadLocale.js","meteor://ðŸ’»app/server/methods/loadMissedMessages.js","meteor://ðŸ’»app/server/methods/loadNextMessages.js","meteor://ðŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ðŸ’»app/server/methods/logoutCleanUp.js","meteor://ðŸ’»app/server/methods/messageSearch.js","meteor://ðŸ’»app/server/methods/migrate.js","meteor://ðŸ’»app/server/methods/muteUserInRoom.js","meteor://ðŸ’»app/server/methods/openRoom.js","meteor://ðŸ’»app/server/methods/readMessages.js","meteor://ðŸ’»app/server/methods/registerUser.js","meteor://ðŸ’»app/server/methods/removeRoomModerator.js","meteor://ðŸ’»app/server/methods/removeRoomOwner.js","meteor://ðŸ’»app/server/methods/removeUserFromRoom.js","meteor://ðŸ’»app/server/methods/reportMessage.js","meteor://ðŸ’»app/server/methods/resetAvatar.js","meteor://ðŸ’»app/server/methods/saveUserPreferences.js","meteor://ðŸ’»app/server/methods/saveUserProfile.js","meteor://ðŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ðŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ðŸ’»app/server/methods/setAvatarFromService.js","meteor://ðŸ’»app/server/methods/setUserActiveStatus.js","meteor://ðŸ’»app/server/methods/setUserPassword.js","meteor://ðŸ’»app/server/methods/toogleFavorite.js","meteor://ðŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ðŸ’»app/server/methods/userSetUtcOffset.js","meteor://ðŸ’»app/server/publications/activeUsers.js","meteor://ðŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ðŸ’»app/server/publications/fullUserData.js","meteor://ðŸ’»app/server/publications/messages.js","meteor://ðŸ’»app/server/publications/privateHistory.js","meteor://ðŸ’»app/server/publications/room.js","meteor://ðŸ’»app/server/publications/roomFiles.js","meteor://ðŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ðŸ’»app/server/publications/spotlight.js","meteor://ðŸ’»app/server/publications/subscription.js","meteor://ðŸ’»app/server/publications/userAutocomplete.js","meteor://ðŸ’»app/server/publications/userChannels.js","meteor://ðŸ’»app/server/publications/userData.js","meteor://ðŸ’»app/server/stream/messages.js","meteor://ðŸ’»app/server/stream/streamBroadcast.js","meteor://ðŸ’»app/lib/RegExp.js","meteor://ðŸ’»app/lib/fileUpload.js","meteor://ðŸ’»app/lib/francocatena_fix.js","meteor://ðŸ’»app/lib/underscore.string.js"],"names":["getIdentity","accessToken","HTTP","get","params","access_token","data","error","_","extend","Error","message","response","Accounts","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","Date","now","expiresIn","whitelisted","fields","pick","options","profile","updateOrCreateUserFromExternalService","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","RocketChat","settings","config","emailTemplates","siteName","from","verifyEmailHtml","verifyEmail","text","html","user","url","replace","Meteor","absoluteUrl","resetPasswordHtml","resetPassword","enrollAccount","subject","TAPi18n","__","lng","language","placeholders","header","footer","name","email","emails","address","onCreateUser","callbacks","run","status","active","services","Object","values","service","username","verified","insertUserDoc","wrap","roles","Match","test","globalRoles","String","length","concat","password","defaultAuthServiceRoles","split","map","s","trim","type","_id","call","users","findOne","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","hasAdmin","models","Users","push","authz","addUserRoles","validateLoginAttempt","login","allowed","includes","validEmail","filter","updateLastLoginById","defer","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","methods","push_test","method","hasRole","Push","enabled","query","$and","userId","$or","$exists","tokens","appCollection","find","count","send","title","apn","sound","sendPush","token","tries","post","statusCode","console","log","remove","SystemLogger","milli","Math","pow","setTimeout","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","forEach","app","topic","appName","startup","Migrations","add","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","RocketChatFile","dataURIParse","image","contentType","rs","bufferToStream","Buffer","ws","RocketChatFileAvatarInstance","createWriteStream","on","bindEnvironment","setAvatarOrigin","pipe","Subscriptions","tryDropIndex","uid","nonreactive","sub","update","findOneById","$set","$unset","Rooms","room","$in","uids","usernames","t","k","v","oldId","sort","join","insert","removeById","rid","multi","Messages","rn","$rename","item","Random","id","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","u","by","findOneByName","upsert","index","urls","isString","OEmbed","rocketUrlParser","Settings","CDN_PREFIX","value","group","ENV","MAIL_URL","denyUnverifiedEmails","public","avatarStore","path","toMigrate","source","Collection","target","model","OEmbedCache","collection","rawCollection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","createdAt","setAllUsersActive","metaKeys","old","oldAndNew","oldSetting","oldValue","newSetting","new","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","Uploads","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","record","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","to","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","file","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","Roles","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","module","import","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","e","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","bot","__migration_assets_files","Mongo","chunks","__migration_assets_chunks","list","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","i18nDescription","favoriteRooms","lastVisitor","limit","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","ts","code","tryEnsureIndex","label","escapeHTML","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","section","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","getVersion","migrateTo","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","getFileType","storeType","RocketChatStore","transformWrite","readStream","writeStream","height","width","gm","fileName","background","resize","gravity","crop","extent","stream","absolutePath","WebApp","connectHandlers","use","req","res","decodeURIComponent","writeHead","write","end","sandstorm","picture","setHeader","getFileWithReadStream","reqModifiedHeader","colors","color","initials","position","usernameParts","first","substr","toUpperCase","svg","toUTCString","once","chunk","fileType","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","host","warn","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","obj","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","db","create","statusDefault","utcOffset","getBinary","deleteFile","process","env","ADMIN_PASS","adminUser","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","roomTypes","setPublish","identifier","cl","muted","archived","ro","reactWhenReadOnly","jitsiTimeout","description","sysMes","joinCodeRequired","hasPermission","joinCode","findByTypeAndName","roomId","findByTypeNameAndUserId","findById","ready","findByTypeAndNameContainingUsername","hasAtLeastOnePermission","findByTypeContainingUsernames","fs","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","toString","desiredNodeVersionMajor","parse","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","error_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","Array","isArray","a","primary","emailAddress","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","arguments","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","check","userCount","findOneByRoomIdAndUserId","addUsernameById","createWithRoomAndUser","open","alert","unread","createUserJoinWithRoomIdAndUser","addRoomModerator","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","role","Notifications","notifyLogged","addRoomOwner","canAccessRoom","channelsList","channelType","unblock","Optional","Number","isNumber","roomIds","findByTypeAndUserId","userPref","mergeChannels","globalPref","channels","findByNameContainingTypesWithUsername","findContainingTypesWithUsername","createDirectMessage","me","upsertSubscription","ls","DDPRateLimiter","addRule","connectionId","deleteFileMessage","fileID","getMessageByFileId","FileUpload","delete","deleteUser","adminCount","userIsAdmin","indexOf","action","eraseRoom","fromId","facebook","google","github","linkedin","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getTotalChannels","slug","slugify","usernameIsAvaliable","$regex","generateSuggestion","preferredHandle","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","_user","records","findByRoomId","total","groupsList","nameFilter","groups","escapeRegExp","findByIds","hideRoom","hideByRoomIdAndUserId","hideMessagesOfType","types","splice","loadHistory","editedAt","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdNotContainingTypes","messages","starred","unreadNotLoaded","firstUnread","firstMessage","unreadMessages","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","loadLocale","locale","getText","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","mention","r","currentUserName","currentUserId","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","location","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","sortByTimestamp","direction","startsWith","$options","$text","$search","score","$meta","getMigrationVersion","muteUserInRoom","ObjectIncluding","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","setAsReadByRoomIdAndUserId","registerUser","formData","pass","secretURL","validateEmailDomain","userData","importedUser","importIds","createUser","setName","saveCustomFields","userModel","sendVerificationEmail","removeRoomModerator","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeUsernameById","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","messageId","Reports","createWithMessageDescriptionAndUserId","resetAvatar","unsetAvatarOrigin","saveUserPreferences","setLanguage","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","unreadRoomsMode","autoImageLoad","emailNotificationMode","unreadAlert","desktopNotificationDuration","viewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","highlights","sendOnEnter","setPreferences","saveUserProfile","customFields","checkPassword","currentPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","newPassword","logout","realname","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","regex","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","Boolean","setUserActive","unsetLoginTokens","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","publish","findUsersNotOffline","selector","pub","cursorHandle","findByNameStartingAndTypes","observeChanges","added","changed","removed","onStop","stop","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","findByContainingUsername","lm","livechatData","tags","sms","roomMap","_room","findBySubscriptionUserIdUpdatedAfter","trashFindDeletedAfter","_deletedAt","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","cache","notifyUserInThisInstance","cursorFileListHandle","findNotHiddenFilesOfRoom","findByRoomIdAndRoles","spotlight","findByActiveUsersUsernameExcept","findByNameAndTypeNotContainingUsername","audioNotification","desktopNotifications","mobilePushNotifications","emailNotifications","_updatedAt","blocked","blocker","findByUserId","processQueryOptionsOnResult","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","roomType","publishMessage","imported","emitWithoutBroadcast","_db","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","args","StreamerCentral","instances","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","fn","broadcast","fromInstance","results","connected","endpoint","UploadFS","initFileStore","cookie","Cookies","isClient","document","_storedLoginToken","fileStore","GridFS","Filter","onCheck","validateFileUpload","fileId","identify","format","Orientation","autoOrient","onRead","rawCookies","rc_uid","rc_token","findOneByIdAndLoginToken","isServer","Tracker","autorun","c","cachedCollection","i18n_status_func","mixin","each","functions","prototype","exports"],"mappings":"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","file":"/app.js","sourcesContent":["function getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken\n\t\t\t}\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${error.message}`), {\n\t\t\tresponse: error.response\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {}\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","const accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration')\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${RocketChat.settings.get('Site_Name')} <${RocketChat.settings.get('From_Email')}>`;\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${Meteor.absoluteUrl()}login/`);\n\treturn verifyEmailHtml(user, url);\n};\n\nconst resetPasswordHtml = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.resetPassword.html = function(user, url) {\n\turl = url.replace(/\\/#\\//, '/');\n\treturn resetPasswordHtml(user, url);\n};\n\nAccounts.emailTemplates.enrollAccount.subject = function(user = {}) {\n\tlet subject;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\tsubject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\t} else {\n\t\tsubject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\treturn RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/*, url*/) {\n\tlet html;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\thtml = RocketChat.settings.get('Accounts_Enrollment_Email');\n\t} else {\n\t\thtml = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\thtml = RocketChat.placeholders.replace(html, {\n\t\tname: user.name,\n\t\temail: user.emails && user.emails[0] && user.emails[0].address\n\t});\n\n\treturn header + html + footer;\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile && options.profile.name) {\n\t\t\tuser.name = options.profile.name;\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (!user.services || !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map(s => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id: _id\n\t});\n\n\tif (user.username && options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\tMeteor.runAsUser(_id, function() {\n\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t});\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user'\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (hasAdmin) {\n\t\t\troles.push('user');\n\t\t} else {\n\t\t\troles.push('admin');\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter(email => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map(domain => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some(domain => email.match('@' + RegExp.escape(domain) + '$'));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${user.username}`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${user.username}:\\n${TAPi18n.__('This_is_a_push_test_messsage')}`\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens]\n\t\t};\n\t}\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken: token,\n\t\t\toptions: options\n\t\t}\n\t};\n\n\treturn HTTP.post(RocketChat.settings.get('Push_gateway') + `/push/${service}/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${tries} try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend: function(userId/*, notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t}\n\t\t});\n\n\t\tlet apn, gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number')\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert')\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn: apn,\n\t\t\tgcm: gcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 1000,\n\t\t\tsendBatchSize: 10\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = {badge: 0}) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${options.title}\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn Push.enabled = true;\n\t}\n}\n\nMeteor.startup(function() {\n\treturn configurePush();\n});\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst {image, contentType} = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst ws = RocketChatFileAvatarInstance.createWriteStream(`${user.username}.jpg`, contentType);\n\n\t\t\tws.on('end', Meteor.bindEnvironment(function() {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\t}));\n\n\t\t\treturn rs.pipe(ws);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: ''\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: name\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id\n\t\t\t\t}\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = room.name + '-' + Random.id(2).toLowerCase();\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: name\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${newUserName} to all user ${user._id}`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${room._id} to ${newId}`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0]\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${user.username} to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL'\n\t\t\t}, {\n\t\t\t\t$set: room\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t}\n});\n","/* globals OEmbed */\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${index + 1} / ${count}`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl: url\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings'\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General'});\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP'});\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings'\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Meteor.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model\n\t\t\t}, {\n\t\t\t\tsource: new Meteor.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model\n\t\t\t}, {\n\t\t\t\tsource: new Meteor.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model\n\t\t\t}, {\n\t\t\t\tsource: new Meteor.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Meteor.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model\n\t\t\t}\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst {target, source} = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${source.rawCollection().collectionName} to: ${target.rawCollection().collectionName}`);\n\n\t\t\tsource.find().forEach((doc) => {\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\treturn target.upsert({\n\t\t\t\t\t_id: doc._id\n\t\t\t\t}, doc);\n\t\t\t});\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/*, res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${rawSource.collectionName} collection due to: ${err.errmsg}`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${count} rooms`);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'default': true\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${oldestUser.username} as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_URL'});\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_ID'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Edit'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Delete'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_KeepStatusHistory'});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowEditedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowDeletedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language'\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id'\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots'\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification'\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01'\n\t\t\t}\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.old});\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.new});\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Meteor.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Meteor.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Meteor.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Meteor.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Meteor.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${cfsRecord._id}`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = url + '.' + extension;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension: extension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Meteor.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Meteor.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://demo.rocket.chat/cfs/files/Files/${cfsRecord._id}`\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${cfsRecord._id}`\n\t\t\t\t}]\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://demo.rocket.chat/cfs/files/Files/${cfsRecord._id}`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${cfsRecord._id}`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${url}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://demo.rocket.chat/cfs/files/Files/${cfsRecord._id}`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${cfsRecord._id}`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({_id: message._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({_id: cfsRecord._id});\n\t\t\toldGridFSCollection.remove({_id: oldGridFsFile._id});\n\t\t\toldChunkCollection.remove({files_id: new Meteor.Collection.ObjectID(cfsRecord.copies.files.key)});\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: ''\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${usernames} from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${usernames} to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1\n\t\t\t}\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => {\n\t\t\treturn RocketChat.models.Uploads.update({\n\t\t\t\t_id: msg.file && msg.file._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: msg.rid\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$multi: true\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails'\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: []\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Host'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Encryption'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Domain_Base'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Username_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Unique_Identifier_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Use_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_STUN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Username'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Password'});\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += encodeURIComponent(WebRTC_TURN_Username) + ':' + encodeURIComponent(WebRTC_TURN_Password) + '@';\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({_id: 'WebRTC_Servers'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += integration.processIncomingRequestScript + '\\n\\n';\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += integration.prepareOutgoingRequestScript + '\\n\\n';\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += integration.processOutgoingResponseScript + '\\n\\n';\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, update, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tvar result;\n\t\t\t\t\t\tresult = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tvar addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tvar allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tvar footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tvar footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup: function() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tvar parts = customOauth._id.split('_');\n\t\t\tvar name = parts[3];\n\t\t\tvar id = 'Accounts_OAuth_Custom_' + name + '_token_sent_via';\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t'_id': id,\n\t\t\t\t\t'type': 'select',\n\t\t\t\t\t'group': 'OAuth',\n\t\t\t\t\t'section': 'Custom OAuth: ' + name,\n\t\t\t\t\t'i18nLabel': 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\t'persistent': true,\n\t\t\t\t\t'values': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'header',\n\t\t\t\t\t\t\t'i18nLabel': 'Header'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'payload',\n\t\t\t\t\t\t\t'i18nLabel': 'Payload'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t'packageValue': 'payload',\n\t\t\t\t\t'valueSource': 'packageValue',\n\t\t\t\t\t'ts': new Date(),\n\t\t\t\t\t'hidden': false,\n\t\t\t\t\t'blocked': false,\n\t\t\t\t\t'sorter': 255,\n\t\t\t\t\t'i18nDescription': 'Accounts_OAuth_Custom_' + name + '_token_sent_via_Description',\n\t\t\t\t\t'createdAt': new Date(),\n\t\t\t\t\t'value': 'payload'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${from}`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${to}`, {\n\t\t\t\t\t\turl: `/assets/${to}.${extension}`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [ { 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } } ] }).forEach(function(user) {\n\t\t\t\tvar newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tvar newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tvar optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tvar favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup: function() {\n\n\t\t// finds the latest created visitor\n\t\tvar lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tvar lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tvar autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tvar RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup: function() {\n\n\t\tvar count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup: function() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup: function() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false }}).forEach(function(room) {\n\t\t\tvar user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username\n\t\t\t\t\t}\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup: function() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup: function() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 55,\n\tup: function() {\n\t\tRocketChat.models.Rooms.find({ 'topic': { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic: topic }});\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup: function() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tvar oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup: function() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tvar oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tvar oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tvar oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup: function() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup: function() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst createdAt = users[0].createdAt;\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt: createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 60,\n\tup: function() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [ { name: { $exists: 0 } }, { name: { $not: { $type: 2 } } } ] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup: function() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup: function() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup: function() {\n\t\tvar forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tvar timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 64,\n\tup: function() {\n\t\tRocketChat.models.Messages.find({ 't': 'room_changed_topic', 'msg': /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg: msg }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tvar replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tvar replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tvar replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tvar replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tvar replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tvar replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tvar oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tvar replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true\n\t\t\t\t}\n\t\t\t}, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup: function() {\n\t\tvar GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup: function() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-custom-scrollbar-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.05)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-info-font-color',\n\t\t\t'value': '#aaaaaa'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@secondary-font-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-link-font-color',\n\t\t\t'value': '#008ce3'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@primary-action-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-away',\n\t\t\t'value': '#fcb316'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@pending-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-busy',\n\t\t\t'value': '#d30230'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@error-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-offline',\n\t\t\t'value': 'rgba(150, 150, 150, 0.50)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-online',\n\t\t\t'value': '#35ac19'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@success-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-background-color',\n\t\t\t'value': '#eaeaea'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@component-color'\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-font-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.6)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-lightest'\n\t\t\t}\n\t\t});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup: function() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst _id = setting._id;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id: _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup: function() {\n\t\t//Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ 't': 'rm', 'reactions': { $exists: true, $not: {$size: 0} } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup: function() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup: function() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_64'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_96'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_128'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_256'});\n\t\t\tRocketChat.models.Settings.update({_id: 'Assets_favicon_192'}, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup: function() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup: function() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({section: 'Colors (alphas)'}).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false }\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup: function() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] }}, { $addToSet: { roles: 'bot' }}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup: function() {\n\t\tconst integrations = RocketChat.models.Integrations.find({type: 'webhook-incoming'}).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({_id: integration._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map(channel => channel.trim())\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup: function() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: []\n\t\t\t}, {\n\t\t\t\tchannel: ''\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels']\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup: function() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup: function() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tvar setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tvar username = setting.value;\n\t\t\t\tvar user = RocketChat.models.Users.findOne({ username: username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tvar oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tvar newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: {$size: 2},\n\t\t\tu: {$exists: false},\n\t\t\tname: {$exists: false}\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map(room => room._id);\n\t\t\tRocketChat.models.Rooms.update({_id: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t\tRocketChat.models.Subscriptions.update({rid: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup: function() {\n\t\t// Disabled this migration for it was not updating any user\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup: function() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' }});\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' }}, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false }});\n\t\t});\n\t}\n});\n","if (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo('latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/']\n\t});\n}\n","import getFileType from 'file-type';\n\nMeteor.startup(function() {\n\tlet storeType = 'GridFS';\n\n\tif (RocketChat.settings.get('Accounts_AvatarStoreType')) {\n\t\tstoreType = RocketChat.settings.get('Accounts_AvatarStoreType');\n\t}\n\n\tconst RocketChatStore = RocketChatFile[storeType];\n\n\tif (!RocketChatStore) {\n\t\tthrow new Error(`Invalid RocketChatStore type [${storeType}]`);\n\t}\n\n\tconsole.log((`Using ${storeType} for Avatar storage`).green);\n\n\tfunction transformWrite(file, readStream, writeStream) {\n\t\tif (RocketChatFile.enabled === false || RocketChat.settings.get('Accounts_AvatarResize') !== true) {\n\t\t\treturn readStream.pipe(writeStream);\n\t\t}\n\t\tconst height = RocketChat.settings.get('Accounts_AvatarSize');\n\t\tconst width = height;\n\t\treturn RocketChatFile.gm(readStream, file.fileName).background('#ffffff').resize(width, height + '^').gravity('Center').crop(width, height).extent(width, height).stream('jpeg').pipe(writeStream);\n\t}\n\n\tlet path = '~/uploads';\n\tif (RocketChat.settings.get('Accounts_AvatarStorePath') && RocketChat.settings.get('Accounts_AvatarStorePath').trim() !== '') {\n\t\tpath = RocketChat.settings.get('Accounts_AvatarStorePath');\n\t}\n\n\tthis.RocketChatFileAvatarInstance = new RocketChatStore({\n\t\tname: 'avatars',\n\t\tabsolutePath: path,\n\t\ttransformWrite: transformWrite\n\t});\n\n\treturn WebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/*, next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, ''))\n\t\t};\n\n\t\tlet username = params.username.replace(/\\.jpg$/, '').replace(/^@/, '');\n\n\t\tif (_.isEmpty(params.username)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tlet file;\n\n\t\tif (params.username[0] !== '@') {\n\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfile = RocketChatFileAvatarInstance.getFileWithReadStream(encodeURIComponent(`${username}.jpg`));\n\t\t}\n\n\t\tres.setHeader('Content-Disposition', 'inline');\n\t\tif (!file) {\n\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\t\tres.setHeader('Expires', '-1');\n\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\tif (reqModifiedHeader) {\n\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst colors = ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#03A9F4', '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFC107', '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'];\n\n\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (user && user.name) {\n\t\t\t\t\tusername = user.name;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet color = '';\n\t\t\tlet initials = '';\n\n\t\t\tif (username === '?') {\n\t\t\t\tcolor = '#000';\n\t\t\t\tinitials = username;\n\t\t\t} else {\n\t\t\t\tconst position = username.length % colors.length;\n\n\t\t\t\tcolor = colors[position];\n\t\t\t\tusername = username.replace(/[^A-Za-z0-9]/g, '.').replace(/\\.+/g, '.').replace(/(^\\.)|(\\.$)/g, '');\n\n\t\t\t\tconst usernameParts = username.split('.');\n\n\t\t\t\tinitials = usernameParts.length > 1 ? _.first(usernameParts)[0] + _.last(usernameParts)[0] : username.replace(/[^A-Za-z0-9]/g, '').substr(0, 2);\n\t\t\t\tinitials = initials.toUpperCase();\n\t\t\t}\n\n\t\t\tconst svg = '<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" standalone=\\\"no\\\"?>\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" pointer-events=\\\"none\\\" width=\\\"50\\\" height=\\\"50\\\" style=\\\"width: 50px; height: 50px; background-color: ' + color + ';\\\">\\n\t<text text-anchor=\\\"middle\\\" y=\\\"50%\\\" x=\\\"50%\\\" dy=\\\"0.36em\\\" pointer-events=\\\"auto\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" style=\\\"font-weight: 400; font-size: 28px;\\\">\\n\t\t' + initials + '\\n\t</text>\\n</svg>';\n\t\t\tres.write(svg);\n\t\t\tres.end();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\t\tif (reqModifiedHeader) {\n\t\t\tif (reqModifiedHeader === (file.uploadDate && file.uploadDate.toUTCString())) {\n\t\t\t\tres.setHeader('Last-Modified', reqModifiedHeader);\n\t\t\t\tres.writeHead(304);\n\t\t\t\tres.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\tres.setHeader('Expires', '-1');\n\t\tres.setHeader('Last-Modified', (file.uploadDate && file.uploadDate.toUTCString()) || new Date().toUTCString());\n\t\tres.setHeader('Content-Length', file.length);\n\n\t\tif (file.contentType) {\n\t\t\tres.setHeader('Content-Type', file.contentType);\n\t\t} else {\n\t\t\tfile.readStream.once('data', function(chunk) {\n\t\t\t\tconst fileType = getFileType(chunk);\n\t\t\t\tif (fileType) {\n\t\t\t\t\treturn res.setHeader('Content-Type', fileType.mime);\n\t\t\t\t} else {\n\t\t\t\t\treturn res.setHeader('Content-Type', 'image/jpeg');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfile.readStream.pipe(res);\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger: function(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history'\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/*error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule: function(parser) {\n\t\t\t\treturn parser.cron(new Date().getMinutes() + ' * * * *');\n\t\t\t},\n\t\t\tjob: generateStatistics\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule: function(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(now.getMinutes() + ' ' + now.getHours() + ' * * *');\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache\n\t\t});\n\t\treturn SyncedCron.start();\n\t});\n});\n","function flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, key + '.');\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = ((_.difference(langs, present).join(',')) + ': missing translation for ').red + key.white + ('. Present in [' + (present.join(',')) + ']').red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad('' + error, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","Meteor.startup(function() {\n\tMeteor.defer(function() {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\t'default': true\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.db.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot'\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\n\t\t\tRocketChatFileAvatarInstance.deleteFile('rocket.cat.jpg');\n\n\t\t\tconst ws = RocketChatFileAvatarInstance.createWriteStream('rocket.cat.jpg', 'image/png');\n\n\t\t\tws.on('end', Meteor.bindEnvironment(function() {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local');\n\t\t\t}));\n\n\t\t\trs.pipe(ws);\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log(('Name: ' + adminUser.name).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log(('Email: ' + process.env.ADMIN_EMAIL).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp('^' + RocketChat.settings.get('UTF8_Names_Validation') + '$');\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log(('Username: ' + adminUser.username).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log(('Password: ' + process.env.ADMIN_PASS).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${oldestUser.username} as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user'\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${adminUser.name}`).green);\n\t\t\tconsole.log((`Email: ${adminUser.emails[0].address}`).green);\n\t\t\tconsole.log((`Username: ${adminUser.username}`).green);\n\t\t\tconsole.log((`Password: ${adminUser._id}`).green);\n\n\t\t\tif (RocketChat.models.Users.db.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${adminUser.emails[0].address} already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${adminUser.username} already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: process.env.PORT\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = process.env.INSTANCE_IP;\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","Meteor.startup(function() {\n\tRocketChat.roomTypes.setPublish('c', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\tjoinCodeRequired: 1\n\t\t\t}\n\t\t};\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-join-code')) {\n\t\t\toptions.fields.joinCode = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeAndName('c', identifier, options);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\tconst roomId = RocketChat.models.Subscriptions.findByTypeNameAndUserId('c', identifier, this.userId).fetch();\n\t\t\tif (roomId.length > 0) {\n\t\t\t\treturn RocketChat.models.Rooms.findById(roomId[0].rid, options);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ready();\n\t});\n\n\tRocketChat.roomTypes.setPublish('p', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', identifier, user.username, options);\n\t});\n\n\treturn RocketChat.roomTypes.setPublish('d', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tjitsiTimeout: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\tif (RocketChat.authz.hasAtLeastOnePermission(this.userId, ['view-d-room', 'view-joined-room'])) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeContainingUsernames('d', [user.username, identifier], options);\n\t\t}\n\n\t\treturn this.ready();\n\t});\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${RocketChat.Info.version}`,\n\t\t\t`     NodeJS Version: ${process.versions.node} - ${process.arch}`,\n\t\t\t`           Platform: ${process.platform}`,\n\t\t\t`       Process Port: ${process.env.PORT}`,\n\t\t\t`           Site URL: ${RocketChat.settings.get('Site_Url')}`,\n\t\t\t`   ReplicaSet OpLog: ${oplogState}`\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${RocketChat.Info.commit.hash.substr(0, 10)}`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${RocketChat.Info.commit.branch}`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${desiredNodeVersionMajor}.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","const orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {} /*, options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm'\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tserviceData.email = serviceData.emails.sort(a => a.primary !== true).filter(item => item.verified === true)[0];\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, arguments);\n};\n","Meteor.methods({\n\tOEmbedCacheCleanup: function() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup'\n\t\t\t});\n\t\t}\n\n\t\tvar date = new Date();\n\t\tvar expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared'\n\t\t};\n\t}\n});","Meteor.methods({\n\taddAllUserToRoom: function(rid) {\n\n\t\tcheck (rid, String);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tvar now, room, users;\n\t\t\tvar userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t\troom = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t\tusers = RocketChat.models.Users.find().fetch();\n\t\t\tnow = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tvar subscription;\n\t\t\t\tsubscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Rooms.addUsernameById(rid, user.username);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t}));\n\t\t}\n\t}\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tcanAccessRoom(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user)) {\n\t\t\t\troom.username = user.username;\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1\n\t\t\t}\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst roomTypes = [];\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room')) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c'\n\t\t\t\t});\n\t\t\t} else if (RocketChat.authz.hasPermission(Meteor.userId(), 'view-joined-room')) {\n\t\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', Meteor.userId()).fetch(), 'rid');\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c',\n\t\t\t\t\tids: roomIds\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(Meteor.userId(), 'view-p-room')) {\n\t\t\tconst userPref = Meteor.user() && Meteor.user().settings && Meteor.user().settings.preferences && Meteor.user().settings.preferences.mergeChannels;\n\t\t\tconst globalPref = RocketChat.settings.get('UI_Merge_Channels_Groups');\n\t\t\tconst mergeChannels = userPref || globalPref;\n\n\t\t\tif (mergeChannels) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'p',\n\t\t\t\t\tusername: Meteor.user().username\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (roomTypes.length) {\n\t\t\tif (filter) {\n\t\t\t\treturn {\n\t\t\t\t\tchannels: RocketChat.models.Rooms.findByNameContainingTypesWithUsername(filter, roomTypes, options).fetch()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tchannels: RocketChat.models.Rooms.findContainingTypesWithUsername(roomTypes, options).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tchannels: []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username]\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now\n\t\t\t}\n\t\t});\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid: rid,\n\t\t\t$and: [{'u._id': me._id}] // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid: rid,\n\t\t\t$and: [{'u._id': to._id}] // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\trid: rid\n\t\t};\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'createDirectMessage',\n\tconnectionId() {\n\t\treturn true;\n\t}\n}, 10, 60000);\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage: function(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.delete(fileID);\n\t}\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({roles: 'admin'}).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(fromId, `delete-${room.t}`, rid)) {\n\t\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\t\treturn RocketChat.models.Rooms.removeById(rid);\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: 'https://graph.facebook.com/' + user.services.facebook.id + '/picture?type=large'\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: 'https://avatars.githubusercontent.com/' + user.services.github.username + '?s=200'\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, '')\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings['public'].sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = 'data:' + result.headers['content-type'] + ';base64,';\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t}\n});\n","Meteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room._id;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t}\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c'\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t}\n});\n","/* global slugify */\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername({\n\t\t$regex: new RegExp(`^${username}$`, 'i')\n\t});\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings['public'].sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => {\n\t\t\treturn _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName'));\n\t\t});\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push('user');\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${usernames[0]}-${index}`)) {\n\t\t\tusername = `${usernames[0]}-${index}`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t}\n});\n","Meteor.methods({\n\tgetUsersOfRoom(roomId, showAll) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', roomId, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst filter = (record) => {\n\t\t\tif (!record._user) {\n\t\t\t\tconsole.log('Subscription without user', record._id);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (showAll === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn record._user.status !== 'offline';\n\t\t};\n\n\t\tconst map = (record) => {\n\t\t\treturn record._user.username;\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByRoomId(roomId).fetch();\n\n\t\treturn {\n\t\t\ttotal: records.length,\n\t\t\trecords: records.filter(filter).map(map)\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tgroupsList: function(nameFilter, limit, sort) {\n\n\t\tcheck(nameFilter, Match.Optional(String));\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'groupsList' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: { name: 1 },\n\t\t\tsort: { name: 1 }\n\t\t};\n\n\t\t//Verify the limit param is a number\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\t//Verify there is a sort option and it's a string\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = { name: 1 };\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = { msgs: -1 };\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//Determine if they are searching or not, base it upon the name field\n\t\tif (nameFilter) {\n\t\t\treturn { groups: RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', new RegExp(s.trim(s.escapeRegExp(nameFilter)), 'i'), Meteor.user().username, options).fetch() };\n\t\t} else {\n\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', Meteor.userId()).fetch(), 'rid');\n\t\t\treturn { groups: RocketChat.models.Rooms.findByIds(roomIds, options).fetch() };\n\t\t}\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(fromId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end != null) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampNotContainingTypes(rid, end, hideMessagesOfType, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdNotContainingTypes(rid, hideMessagesOfType, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tlet unreadNotLoaded = 0;\n\t\tlet firstUnread;\n\n\t\tif (ls != null) {\n\t\t\tconst firstMessage = messages[messages.length - 1];\n\n\t\t\tif ((firstMessage != null ? firstMessage.ts : void 0) > ls) {\n\t\t\t\tdelete options.limit;\n\n\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsNotContainingTypes(rid, ls, firstMessage.ts, hideMessagesOfType, {\n\t\t\t\t\tlimit: 1,\n\t\t\t\t\tsort: {\n\t\t\t\t\t\tts: 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessages: messages,\n\t\t\tfirstUnread: firstUnread,\n\t\t\tunreadNotLoaded: unreadNotLoaded\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${locale.toLowerCase()}.js`);\n\t\t} catch (error) {\n\t\t\treturn console.log(error);\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\t'editedAt': 0\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t}\n});\n","Meteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages: messages\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2)\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore: moreBefore,\n\t\t\tmoreAfter: moreAfter\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t}\n});\n","Meteor.methods({\n\tmessageSearch: function(text, rid, limit) {\n\t\tvar from, mention, options, query, r, result, currentUserName, currentUserId, currentUserTimezoneOffset;\n\t\tcheck(text, String);\n\t\tcheck(rid, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcurrentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch'\n\t\t\t});\n\t\t}\n\t\tcurrentUserName = Meteor.user().username;\n\t\tcurrentUserTimezoneOffset = Meteor.user().utcOffset;\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tvar beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tvar afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tvar date, dayAfter;\n\t\t\tdate = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tdayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\t\tresult = {\n\t\t\tmessages: [],\n\t\t\tusers: [],\n\t\t\tchannels: []\n\t\t};\n\t\tquery = {};\n\t\toptions = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit || 20\n\t\t};\n\n\t\t// Query for senders\n\t\tfrom = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Query for senders\n\t\tmention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tr = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2]\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm'  //hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true  // don't return _hidden messages\n\t\t\t};\n\t\t\tif (rid != null) {\n\t\t\t\tquery.rid = rid;\n\t\t\t\tif (Meteor.call('canAccessRoom', rid, currentUserId) !== false) {\n\t\t\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\t\t\toptions.fields = {\n\t\t\t\t\t\t\t'editedAt': 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tresult.messages = RocketChat.models.Messages.find(query, options).fetch();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t}\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${room.t} is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tregisterUser(formData) {\n\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\temail: String,\n\t\t\tpass: String,\n\t\t\tname: String,\n\t\t\tsecretURL: Match.Optional(String)\n\t\t}));\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Rooms.removeUsernameById(data.rid, data.username);\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tRocketChatFileAvatarInstance.deleteFile(`${user.username}.jpg`);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username\n\t\t});\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tcheck(settings, Object);\n\n\t\tif (Meteor.userId()) {\n\t\t\tconst preferences = {};\n\n\t\t\tif (settings.language != null) {\n\t\t\t\tRocketChat.models.Users.setLanguage(Meteor.userId(), settings.language);\n\t\t\t}\n\n\t\t\tif (settings.newRoomNotification) {\n\t\t\t\tpreferences.newRoomNotification = settings.newRoomNotification;\n\t\t\t}\n\n\t\t\tif (settings.newMessageNotification) {\n\t\t\t\tpreferences.newMessageNotification = settings.newMessageNotification;\n\t\t\t}\n\n\t\t\tif (settings.useEmojis) {\n\t\t\t\tpreferences.useEmojis = settings.useEmojis === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.convertAsciiEmoji) {\n\t\t\t\tpreferences.convertAsciiEmoji = settings.convertAsciiEmoji === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.saveMobileBandwidth) {\n\t\t\t\tpreferences.saveMobileBandwidth = settings.saveMobileBandwidth === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.collapseMediaByDefault) {\n\t\t\t\tpreferences.collapseMediaByDefault = settings.collapseMediaByDefault === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.unreadRoomsMode) {\n\t\t\t\tpreferences.unreadRoomsMode = settings.unreadRoomsMode === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.autoImageLoad) {\n\t\t\t\tpreferences.autoImageLoad = settings.autoImageLoad === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode) {\n\t\t\t\tpreferences.emailNotificationMode = settings.emailNotificationMode;\n\t\t\t}\n\n\t\t\tif (settings.mergeChannels !== '-1') {\n\t\t\t\tpreferences.mergeChannels = settings.mergeChannels === '1';\n\t\t\t} else {\n\t\t\t\tdelete preferences.mergeChannels;\n\t\t\t}\n\n\t\t\tif (settings.unreadAlert) {\n\t\t\t\tpreferences.unreadAlert = settings.unreadAlert === '1' ? true : false;\n\t\t\t}\n\n\t\t\tpreferences.desktopNotificationDuration = settings.desktopNotificationDuration - 0;\n\t\t\tpreferences.viewMode = settings.viewMode || 0;\n\t\t\tpreferences.hideUsernames = settings.hideUsernames === '1';\n\t\t\tpreferences.hideRoles = settings.hideRoles === '1';\n\t\t\tpreferences.hideAvatars = settings.hideAvatars === '1';\n\t\t\tpreferences.hideFlexTab = settings.hideFlexTab === '1';\n\t\t\tpreferences.highlights = settings.highlights;\n\t\t\tpreferences.sendOnEnter = settings.sendOnEnter;\n\n\t\t\tRocketChat.models.Users.setPreferences(Meteor.userId(), preferences);\n\n\t\t\treturn true;\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, currentPassword) {\n\t\t\tif (user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim()) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!currentPassword) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: currentPassword,\n\t\t\t\talgorithm: 'sha-256'\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.currentPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false\n\t\t\t});\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tMeteor.call('setRealName', settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.currentPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${error.message}`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${s.escapeRegExp(email)}$`, 'i');\n\t\t\temail = (user.emails || []).map(item => item.address).find(userEmail => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst data = { name: user.name, email };\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', data);\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', data);\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\turl = url.replace('/#/', '/');\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${error.message}`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t}\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${room.t} is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1\n\t\t}\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findByNameStartingAndTypes(selector.name, ['c', 'p'], options).observeChanges({\n\t\tadded: function(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged: function(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved: function(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter: filter,\n\t\tlimit: limit\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","Meteor.publish('messages', function(rid/*, start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit: 50\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded: function(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged: function(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t}\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1\n\t\t}\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded: function(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t},\n\t\tchanged: function(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n","Meteor.publish('privateHistory', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Rooms.findByContainingUsername(RocketChat.models.Users.findOneById(this.userId).username, {\n\t\tfields: {\n\t\t\tt: 1,\n\t\t\tname: 1,\n\t\t\tmsgs: 1,\n\t\t\tts: 1,\n\t\t\tlm: 1,\n\t\t\tcl: 1\n\t\t}\n\t});\n});\n","const options = {\n\tfields: {\n\t\t_id: 1,\n\t\tname: 1,\n\t\tt: 1,\n\t\tcl: 1,\n\t\tu: 1,\n\t\t// usernames: 1,\n\t\ttopic: 1,\n\t\tmuted: 1,\n\t\tarchived: 1,\n\t\tjitsiTimeout: 1,\n\t\tdescription: 1,\n\t\tdefault: 1,\n\n\t\t// @TODO create an API to register this fields based on room type\n\t\tlivechatData: 1,\n\t\ttags: 1,\n\t\tsms: 1,\n\t\tcode: 1,\n\t\topen: 1,\n\t\tv: 1,\n\t\tlabel: 1,\n\t\tro: 1\n\t}\n};\n\n\nconst roomMap = (record) => {\n\tif (record._room) {\n\t\treturn _.pick(record._room, ...Object.keys(options.fields));\n\t}\n\tconsole.log('Empty Room for Subscription', record);\n\treturn {};\n};\n\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, {fields: {_id: 1, _deletedAt: 1}}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, Meteor.userId())) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\treturn roomMap({_room: room});\n\t}\n});\n\nRocketChat.models.Rooms.cache.on('sync', (type, room/*, diff*/) => {\n\tconst records = RocketChat.models.Subscriptions.findByRoomId(room._id).fetch();\n\tfor (const record of records) {\n\t\tRocketChat.Notifications.notifyUserInThisInstance(record.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', (type, subscription/*, diff*/) => {\n\tif (type === 'inserted') {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t\t}\n\t}\n});\n","Meteor.publish('roomFiles', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, limit).observeChanges({\n\t\tadded: function(_id, record) {\n\t\t\treturn pub.added('room_files', _id, record);\n\t\t},\n\t\tchanged: function(_id, record) {\n\t\t\treturn pub.changed('room_files', _id, record);\n\t\t},\n\t\tremoved: function(_id, record) {\n\t\t\treturn pub.removed('room_files', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.methods({\n\tspotlight: function(text, usernames, type = {users: true, rooms: true}) {\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: []\n\t\t};\n\n\t\tif (this.userId == null) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\n\t\tif (type.users === true && RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersUsernameExcept(text, usernames, {\n\t\t\t\tlimit: 5,\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tstatus: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t}\n\n\t\tif (type.rooms === true && RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\tconst username = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\t\tusername: 1\n\t\t\t}).username;\n\n\t\t\tresult.rooms = RocketChat.models.Rooms.findByNameAndTypeNotContainingUsername(regex, 'c', username, {\n\t\t\t\tlimit: 5,\n\t\t\t\tfields: {\n\t\t\t\t\tt: 1,\n\t\t\t\t\tname: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tname: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t}\n\t\treturn result;\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tarchived: 1,\n\taudioNotification: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = {\n\t\t\tfields: fields\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId()\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', function(type, subscription) {\n\treturn RocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', type, RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields: fields\n\t}));\n});\n","Meteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1\n\t\t},\n\t\tlimit: 10\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded: function(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged: function(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved: function(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\tstatusLivechat: 1\n\t\t}\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = room.usernames.indexOf(room.username) > -1;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages._db.on('change', function({action, id, data/*, oplog*/}) {\n\t\tswitch (action) {\n\t\t\tcase 'insert':\n\t\t\t\tdata._id = id;\n\t\t\t\tpublishMessage('inserted', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:record':\n\t\t\t\tpublishMessage('updated', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:diff':\n\t\t\t\tpublishMessage('updated', RocketChat.models.Messages.findOne({\n\t\t\t\t\t_id: id\n\t\t\t\t}));\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport {DDPCommon} from 'meteor/ddp-common';\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream'\n\t}\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${instance}`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${instance} ${InstanceStatus.id()} ${connections[instance].instanceId}`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${instance}`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id()\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true\n\t\t}\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1\n\t\t}\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${record.extraInformation.host}:${record.extraInformation.port}`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${record.extraInformation.port}`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${record.extraInformation.host}:${record.extraInformation.port}`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = 'localhost:' + record.extraInformation.port;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t}\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t}\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {streamName, eventName, args} = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/*, userId*/) {\n\t\tconst fromInstance = `${process.env.INSTANCE_IP}:${process.env.PORT}`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${fromInstance}' to '${connection._stream.endpoint}' with name ${streamName} to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${fromInstance}' to '${connection._stream.endpoint}' with name ${streamName} not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${fromInstance}' to '${connection._stream.endpoint}' with name ${streamName} does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","/* globals UploadFS, Cookies, FileUpload */\n\nif (UploadFS) {\n\tconst initFileStore = function() {\n\t\tconst cookie = new Cookies();\n\t\tif (Meteor.isClient) {\n\t\t\tdocument.cookie = 'rc_uid=' + escape(Meteor.userId()) + '; path=/';\n\t\t\tdocument.cookie = 'rc_token=' + escape(Accounts._storedLoginToken()) + '; path=/';\n\t\t}\n\n\t\tMeteor.fileStore = new UploadFS.store.GridFS({\n\t\t\tcollection: RocketChat.models.Uploads.model,\n\t\t\tname: 'rocketchat_uploads',\n\t\t\tcollectionName: 'rocketchat_uploads',\n\t\t\tfilter: new UploadFS.Filter({\n\t\t\t\tonCheck: FileUpload.validateFileUpload\n\t\t\t}),\n\t\t\ttransformWrite(readStream, writeStream, fileId, file) {\n\t\t\t\tif (RocketChatFile.enabled === false || !/^image\\/.+/.test(file.type)) {\n\t\t\t\t\treturn readStream.pipe(writeStream);\n\t\t\t\t}\n\n\t\t\t\tlet stream = undefined;\n\n\t\t\t\tconst identify = function(err, data) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn stream.pipe(writeStream);\n\t\t\t\t\t}\n\n\t\t\t\t\tfile.identify = {\n\t\t\t\t\t\tformat: data.format,\n\t\t\t\t\t\tsize: data.size\n\t\t\t\t\t};\n\n\t\t\t\t\tif (data.Orientation && !['', 'Unknown', 'Undefined'].includes(data.Orientation)) {\n\t\t\t\t\t\tRocketChatFile.gm(stream).autoOrient().stream().pipe(writeStream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.pipe(writeStream);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tstream = RocketChatFile.gm(readStream).identify(identify).stream();\n\t\t\t},\n\n\t\t\tonRead(fileId, file, req, res) {\n\t\t\t\tif (RocketChat.settings.get('FileUpload_ProtectFiles')) {\n\t\t\t\t\tlet uid, token;\n\n\t\t\t\t\tif (req && req.headers && req.headers.cookie) {\n\t\t\t\t\t\tconst rawCookies = req.headers.cookie;\n\n\t\t\t\t\t\tif (rawCookies) {\n\t\t\t\t\t\t\tuid = cookie.get('rc_uid', rawCookies) ;\n\t\t\t\t\t\t\ttoken = cookie.get('rc_token', rawCookies);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!uid) {\n\t\t\t\t\t\tuid = req.query.rc_uid;\n\t\t\t\t\t\ttoken = req.query.rc_token;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!uid || !token || !RocketChat.models.Users.findOneByIdAndLoginToken(uid, token)) {\n\t\t\t\t\t\tres.writeHead(403);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tres.setHeader('content-disposition', `attachment; filename=\"${ encodeURIComponent(file.name) }\"`);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t};\n\n\tMeteor.startup(function() {\n\t\tif (Meteor.isServer) {\n\t\t\tinitFileStore();\n\t\t} else {\n\t\t\tTracker.autorun(function(c) {\n\t\t\t\tif (Meteor.userId() && RocketChat.settings.cachedCollection.ready.get()) {\n\t\t\t\t\tinitFileStore();\n\t\t\t\t\tc.stop();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n","/* globals mixin */\n\n// This will add underscore.string methods to Underscore.js\n// except for include, contains, reverse and join that are\n// dropped because they collide with the functions already\n// defined by Underscore.js.\n\nmixin = function(obj) {\n\t_.each(_.functions(obj), function(name) {\n\t\tif (!_[name] && !_.prototype[name]) {\n\t\t\t_[name] = obj[name];\n\t\t}\n\t});\n};\n\nmixin(s.exports());\n"]}
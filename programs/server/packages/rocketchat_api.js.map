{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:api/server/api.js","meteor://ðŸ’»app/packages/rocketchat:api/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getPaginationItems.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/parseJsonQuery.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/channels.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/chat.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/groups.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/im.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/integrations.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/misc.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/stats.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/users.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/info.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/metrics.js"],"names":["API","properties","logger","Logger","version","authMethods","helperMethods","Map","defaultFieldsToExclude","joinCode","$loki","meta","_config","defaultOptionsEndpoint","request","method","headers","RocketChat","settings","get","response","writeHead","write","done","addAuthMethod","push","success","result","_","isObject","statusCode","body","failure","errorType","error","unauthorized","msg","addRoute","routes","options","endpoints","isArray","forEach","route","Object","keys","action","originalAction","debug","toUpperCase","url","apply","e","v1","message","name","helperMethod","Restivus","getUserAuth","_getUserAuth","invalidResults","undefined","token","user","bodyParams","payload","JSON","parse","i","length","arguments","includes","Accounts","_hashLoginToken","userId","useDefaultAuth","prettyJson","enableCors","auth","default","addGroup","section","add","type","enableQuery","_id","value","set","_getPaginationItems","hardUpperLimit","defaultCount","offset","queryParams","parseInt","count","_getUserFromParams","doesntExist","_doesntExist","trim","models","Users","findOneById","username","findOneByUsername","Meteor","Error","_parseJsonQuery","sort","warn","fields","query","_getLoggedInUser","findOne","findChannelById","roomId","checkedArchived","room","Rooms","t","archived","authRequired","post","findResult","runAsUser","call","channel","getUserFromParams","latest","oldest","Date","inclusive","sub","Subscriptions","findOneByRoomIdAndUserId","open","authz","hasPermission","members","customFields","readOnly","id","rid","includeAllPublicChannels","ourQuery","$in","getPaginationItems","parseJsonQuery","assign","integrations","Integrations","find","_createdAt","skip","limit","fetch","total","latestDate","oldestDate","unreads","messages","rooms","channels","pluck","findByTypeAndUserId","totalCount","processQueryOptionsOnResult","online","findUsersNotOffline","onlineInRoom","usernames","indexOf","description","purpose","ro","topic","check","Match","ObjectIncluding","msgId","String","asUser","Maybe","Boolean","Messages","u","ts","now","messageReturn","processWebhookMessage","text","findPrivateGroupByIdOrName","roomName","roomSub","findOneByRoomNameAndUserId","group","_room","includeAllPrivateGroups","channelsToSearch","groups","findDirectMessageRoomById","msgs","ims","enabled","urls","event","triggerWords","alias","avatar","emoji","scriptEnabled","script","targetChannel","integration","history","IntegrationHistory","_updatedAt","items","target_url","integrationId","getLoggedInUser","hasRole","info","Info","pick","hidden","$ne","public","Settings","findOneNotHiddenById","urlParams","Any","updateValueNotHiddenById","refresh","stats","statistics","Statistics","email","password","active","roles","Array","joinDefaultChannels","requirePasswordChange","sendWelcomeEmail","verified","newUserId","saveUser","saveCustomFields","getURL","cdn","full","setHeader","presence","status","connectionStatus","statusConnection","lastLogin","filter","fieldsToKeepFromRegularUsers","avatarOrigin","emails","phone","createdAt","services","requirePasswordChangeReason","statusDefault","ourFields","users","avatarUrl","setUserAvatar","Busboy","Npm","require","busboy","wrapAsync","callback","on","bindEnvironment","fieldname","file","filename","encoding","mimetype","imageData","data","Buffer","concat","pipe","userData","extend","promclient","register","metrics"],"mappings":"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","file":"/packages/rocketchat_api.js","sourcesContent":["/* global Restivus */\nclass API extends Restivus {\n\tconstructor(properties) {\n\t\tsuper(properties);\n\t\tthis.logger = new Logger(`API ${properties.version ? properties.version : 'default'} Logger`, {});\n\t\tthis.authMethods = [];\n\t\tthis.helperMethods = new Map();\n\t\tthis.defaultFieldsToExclude = {\n\t\t\tjoinCode: 0,\n\t\t\t$loki: 0,\n\t\t\tmeta: 0\n\t\t};\n\n\t\tthis._config.defaultOptionsEndpoint = function() {\n\t\t\tif (this.request.method === 'OPTIONS' && this.request.headers['access-control-request-method']) {\n\t\t\t\tif (RocketChat.settings.get('API_Enable_CORS') === true) {\n\t\t\t\t\tthis.response.writeHead(200, {\n\t\t\t\t\t\t'Access-Control-Allow-Origin': RocketChat.settings.get('API_CORS_Origin'),\n\t\t\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept, X-User-Id, X-Auth-Token'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.response.writeHead(405);\n\t\t\t\t\tthis.response.write('CORS not enabled. Go to \"Admin > General > REST Api\" to enable it.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.response.writeHead(404);\n\t\t\t}\n\n\t\t\tthis.done();\n\t\t};\n\t}\n\n\taddAuthMethod(method) {\n\t\tthis.authMethods.push(method);\n\t}\n\n\tsuccess(result={}) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = true;\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 200,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\tfailure(result, errorType) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = false;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result\n\t\t\t};\n\n\t\t\tif (errorType) {\n\t\t\t\tresult.errorType = errorType;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 400,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\n\tunauthorized(msg) {\n\t\treturn {\n\t\t\tstatusCode: 403,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'unauthorized'\n\t\t\t}\n\t\t};\n\t}\n\n\taddRoute(routes, options, endpoints) {\n\t\t//Note: required if the developer didn't provide options\n\t\tif (typeof endpoints === 'undefined') {\n\t\t\tendpoints = options;\n\t\t\toptions = {};\n\t\t}\n\n\t\t//Allow for more than one route using the same option and endpoints\n\t\tif (!_.isArray(routes)) {\n\t\t\troutes = [routes];\n\t\t}\n\n\t\troutes.forEach((route) => {\n\t\t\t//Note: This is required due to Restivus calling `addRoute` in the constructor of itself\n\t\t\tif (this.helperMethods) {\n\t\t\t\tObject.keys(endpoints).forEach((method) => {\n\t\t\t\t\tif (typeof endpoints[method] === 'function') {\n\t\t\t\t\t\tendpoints[method] = { action: endpoints[method] };\n\t\t\t\t\t}\n\n\t\t\t\t\t//Add a try/catch for each much\n\t\t\t\t\tconst originalAction = endpoints[method].action;\n\t\t\t\t\tendpoints[method].action = function() {\n\t\t\t\t\t\tthis.logger.debug(`${this.request.method.toUpperCase()}: ${this.request.url}`);\n\t\t\t\t\t\tlet result;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = originalAction.apply(this);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.logger.debug(`${method} ${route} threw an error:`, e);\n\t\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message, e.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result ? result : RocketChat.API.v1.success();\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const [name, helperMethod] of this.helperMethods) {\n\t\t\t\t\t\tendpoints[method][name] = helperMethod;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Allow the endpoints to make usage of the logger which respects the user's settings\n\t\t\t\t\tendpoints[method].logger = this.logger;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsuper.addRoute(route, options, endpoints);\n\t\t});\n\t}\n}\n\nRocketChat.API = {};\n\nconst getUserAuth = function _getUserAuth() {\n\tconst invalidResults = [undefined, null, false];\n\treturn {\n\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\tuser: function() {\n\t\t\tif (this.bodyParams && this.bodyParams.payload) {\n\t\t\t\tthis.bodyParams = JSON.parse(this.bodyParams.payload);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < RocketChat.API.v1.authMethods.length; i++) {\n\t\t\t\tconst method = RocketChat.API.v1.authMethods[i];\n\n\t\t\t\tif (typeof method === 'function') {\n\t\t\t\t\tconst result = method.apply(this, arguments);\n\t\t\t\t\tif (!invalidResults.includes(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet token;\n\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\ttoken\n\t\t\t};\n\t\t}\n\t};\n};\n\nRocketChat.API.v1 = new API({\n\tversion: 'v1',\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n\nRocketChat.API.default = new API({\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Upper_Count_Limit', 100, { type: 'int', public: false });\n\t\tthis.add('API_Default_Count', 50, { type: 'int', public: false });\n\t\tthis.add('API_Allow_Infinite_Count', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Direct_Message_History_EndPoint', false, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_CORS', false, { type: 'boolean', public: false });\n\t\tthis.add('API_CORS_Origin', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_CORS', value: true } });\n\t});\n});\n","// If the count query param is higher than the \"API_Upper_Count_Limit\" setting, then we limit that\n// If the count query param isn't defined, then we set it to the \"API_Default_Count\" setting\n// If the count is zero, then that means unlimited and is only allowed if the setting \"API_Allow_Infinite_Count\" is true\n\nRocketChat.API.v1.helperMethods.set('getPaginationItems', function _getPaginationItems() {\n\tconst hardUpperLimit = RocketChat.settings.get('API_Upper_Count_Limit') <= 0 ? 100 : RocketChat.settings.get('API_Upper_Count_Limit');\n\tconst defaultCount = RocketChat.settings.get('API_Default_Count') <= 0 ? 50 : RocketChat.settings.get('API_Default_Count');\n\tconst offset = this.queryParams.offset ? parseInt(this.queryParams.offset) : 0;\n\tlet count = defaultCount;\n\n\t// Ensure count is an appropiate amount\n\tif (typeof this.queryParams.count !== 'undefined') {\n\t\tcount = parseInt(this.queryParams.count);\n\t} else {\n\t\tcount = defaultCount;\n\t}\n\n\tif (count > hardUpperLimit) {\n\t\tcount = hardUpperLimit;\n\t}\n\n\tif (count === 0 && !RocketChat.settings.get('API_Allow_Infinite_Count')) {\n\t\tcount = defaultCount;\n\t}\n\n\treturn {\n\t\toffset,\n\t\tcount\n\t};\n});\n","//Convience method, almost need to turn it into a middleware of sorts\nRocketChat.API.v1.helperMethods.set('getUserFromParams', function _getUserFromParams() {\n\tconst doesntExist = { _doesntExist: true };\n\tlet user;\n\n\tswitch (this.request.method) {\n\t\tcase 'POST':\n\t\tcase 'PUT':\n\t\t\tif (this.bodyParams.userId && this.bodyParams.userId.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneById(this.bodyParams.userId) || doesntExist;\n\t\t\t} else if (this.bodyParams.username && this.bodyParams.username.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.bodyParams.username) || doesntExist;\n\t\t\t} else if (this.bodyParams.user && this.bodyParams.user.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.bodyParams.user) || doesntExist;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (this.queryParams.userId && this.queryParams.userId.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneById(this.queryParams.userId) || doesntExist;\n\t\t\t} else if (this.queryParams.username && this.queryParams.username.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.queryParams.username) || doesntExist;\n\t\t\t} else if (this.queryParams.user && this.queryParams.user.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.queryParams.user) || doesntExist;\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\tif (!user) {\n\t\tthrow new Meteor.Error('error-user-param-not-provided', 'The required \"userId\" or \"username\" param was not provided');\n\t} else if (user._doesntExist) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'The required \"userId\" or \"username\" param provided does not match any users');\n\t}\n\n\treturn user;\n});\n","RocketChat.API.v1.helperMethods.set('parseJsonQuery', function _parseJsonQuery() {\n\tlet sort;\n\tif (this.queryParams.sort) {\n\t\ttry {\n\t\t\tsort = JSON.parse(this.queryParams.sort);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid sort parameter provided \"${this.queryParams.sort}\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-sort', `Invalid sort parameter provided: \"${this.queryParams.sort}\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet fields;\n\tif (this.queryParams.fields) {\n\t\ttry {\n\t\t\tfields = JSON.parse(this.queryParams.fields);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid fields parameter provided \"${this.queryParams.fields}\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-fields', `Invalid fields parameter provided: \"${this.queryParams.fields}\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet query;\n\tif (this.queryParams.query) {\n\t\ttry {\n\t\t\tquery = JSON.parse(this.queryParams.query);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid query parameter provided \"${this.queryParams.query}\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-query', `Invalid query parameter provided: \"${this.queryParams.query}\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\treturn {\n\t\tsort,\n\t\tfields,\n\t\tquery\n\t};\n});\n","RocketChat.API.v1.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","//Returns the channel IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findChannelById({ roomId, checkedArchived = true }) {\n\tif (!roomId || !roomId.trim()) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t}\n\n\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: RocketChat.API.v1.defaultFieldsToExclude });\n\n\tif (!room || room.t !== 'c') {\n\t\tthrow new Meteor.Error('error-room-not-found', `No channel found by the id of: ${roomId}`);\n\t}\n\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${room.name}, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('channels.addAll', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addModerator', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addOwner', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.archive', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.cleanHistory', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tif (!this.bodyParams.latest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"latest\" is required.');\n\t\t}\n\n\t\tif (!this.bodyParams.oldest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"oldest\" is required.');\n\t\t}\n\n\t\tconst latest = new Date(this.bodyParams.latest);\n\t\tconst oldest = new Date(this.bodyParams.oldest);\n\n\t\tlet inclusive = false;\n\t\tif (typeof this.bodyParams.inclusive !== 'undefined') {\n\t\t\tinclusive = this.bodyParams.inclusive;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('cleanChannelHistory', { roomId: findResult._id, latest, oldest, inclusive });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.close', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${findResult.name}.`);\n\t\t}\n\n\t\tif (!sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${findResult.name}, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.create', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createChannel', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.delete', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\t//The find method returns either with the group or the failur\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: findResult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.getIntegrations', { authRequired: true }, {\n\tget: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.queryParams.roomId, checkedArchived: false });\n\n\t\tlet includeAllPublicChannels = true;\n\t\tif (typeof this.queryParams.includeAllPublicChannels !== 'undefined') {\n\t\t\tincludeAllPublicChannels = this.queryParams.includeAllPublicChannels === 'true';\n\t\t}\n\n\t\tlet ourQuery = {\n\t\t\tchannel: `#${findResult.name}`\n\t\t};\n\n\t\tif (includeAllPublicChannels) {\n\t\t\tourQuery.channel = {\n\t\t\t\t$in: [ourQuery.channel, 'all_public_channels']\n\t\t\t};\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.history', { authRequired: true }, {\n\tget: function() {\n\t\tconst findResult = findChannelById({ roomId: this.queryParams.roomId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult._id, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.info', { authRequired: true }, {\n\tget: function() {\n\t\tconst findResult = findChannelById({ roomId: this.queryParams.roomId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.invite', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.join', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('joinRoom', findResult._id, this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.kick', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.leave', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list', { authRequired: true }, {\n\tget: {\n\t\t//This is like this only to provide an example of how we routes can be defined :X\n\t\taction: function() {\n\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t\t}).fetch();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tchannels: rooms,\n\t\t\t\tcount: rooms.length,\n\t\t\t\toffset,\n\t\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t\t});\n\t\t}\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list.joined', { authRequired: true }, {\n\tget: function() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannels: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n\tget: function() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.open', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${findResult.name}\".`);\n\t\t}\n\n\t\tif (sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${findResult.name}, is already open to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeModerator', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeOwner', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.rename', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.name === this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('The channel name is the same as what it would be renamed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setDescription', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.description === this.bodyParams.description) {\n\t\t\treturn RocketChat.API.v1.failure('The channel description is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setJoinCode', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.joinCode || !this.bodyParams.joinCode.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"joinCode\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'joinCode', this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setPurpose', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.description === this.bodyParams.purpose) {\n\t\t\treturn RocketChat.API.v1.failure('The channel purpose (description) is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setReadOnly', { authRequired: true }, {\n\tpost: function() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The channel read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setTopic', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.topic === this.bodyParams.topic) {\n\t\t\treturn RocketChat.API.v1.failure('The channel topic is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setType', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The channel type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.unarchive', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findChannelById({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\tif (!findResult.archived) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${findResult.name}, is not archived`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","/* global processWebhookMessage */\nRocketChat.API.v1.addRoute('chat.delete', { authRequired: true }, {\n\tpost: function() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tmsgId: String,\n\t\t\troomId: String,\n\t\t\tasUser: Match.Maybe(Boolean)\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId, { fields: { u: 1, rid: 1 }});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${this.bodyParams.msgId}\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.bodyParams.asUser ? msg.u._id : this.userId, () => {\n\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\t_id: msg._id,\n\t\t\tts: Date.now()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.postMessage', { authRequired: true }, {\n\tpost: function() {\n\t\tconst messageReturn = processWebhookMessage(this.bodyParams, this.user)[0];\n\n\t\tif (!messageReturn) {\n\t\t\treturn RocketChat.API.v1.failure('unknown-error');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tts: Date.now(),\n\t\t\tchannel: messageReturn.channel,\n\t\t\tmessage: messageReturn.message\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.update', { authRequired: true }, {\n\tpost: function() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\troomId: String,\n\t\t\tmsgId: String,\n\t\t\ttext: String //Using text to be consistant with chat.postMessage\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId);\n\n\t\t//Ensure the message exists\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${this.bodyParams.msgId}\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: this.bodyParams.text, rid: msg.rid });\n\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: RocketChat.models.Messages.findOneById(msg._id)\n\t\t});\n\t}\n});\n","//Returns the private group subscription IF found otherwise it will reutrn the failure of why it didn't. Check the `statusCode` property\nfunction findPrivateGroupByIdOrName({ roomId, roomName, userId, checkedArchived = true }) {\n\tif ((!roomId || !roomId.trim()) && (!roomName || !roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet roomSub;\n\tif (roomId) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, userId);\n\t} else if (roomName) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomNameAndUserId(roomName, userId);\n\t}\n\n\tif (!roomSub || roomSub.t !== 'p') {\n\t\tthrow new Meteor.Error('error-room-not-found', `No private group by the id of: ${roomId}`);\n\t}\n\n\tif (checkedArchived && roomSub.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${roomSub.name}, is archived`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute('groups.addModerator', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addOwner', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Archives a private group only if it wasn't\nRocketChat.API.v1.addRoute('groups.archive', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.close', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group with an id \"${this.bodyParams.roomId}\" is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Create Private Group\nRocketChat.API.v1.addRoute('groups.create', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createPrivateGroup', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.delete', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.processQueryOptionsOnResult([findResult._room], { fields: RocketChat.API.v1.defaultFieldsToExclude })[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.getIntegrations', { authRequired: true }, {\n\tget: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.queryParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tlet includeAllPrivateGroups = true;\n\t\tif (typeof this.queryParams.includeAllPrivateGroups !== 'undefined') {\n\t\t\tincludeAllPrivateGroups = this.queryParams.includeAllPrivateGroups === 'true';\n\t\t}\n\n\t\tconst channelsToSearch = [`#${findResult.name}`];\n\t\tif (includeAllPrivateGroups) {\n\t\t\tchannelsToSearch.push('all_private_groups');\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { channel: { $in: channelsToSearch } });\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.history', { authRequired: true }, {\n\tget: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.queryParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.info', { authRequired: true }, {\n\tget: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.queryParams.roomId, roomName: this.queryParams.roomName, userId: this.userId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.invite', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.kick', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.leave', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//List Private Groups a user has access to\nRocketChat.API.v1.addRoute('groups.list', { authRequired: true }, {\n\tget: function() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.online', { authRequired: true }, {\n\tget: function() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Group does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.open', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${this.bodyParams.name}, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeModerator', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeOwner', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.rename', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setDescription', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setPurpose', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setReadOnly', { authRequired: true }, {\n\tpost: function() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The private group read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setTopic', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setType', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The private group type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.unarchive', { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","function findDirectMessageRoomById(roomId, userId) {\n\tif (!roomId || !roomId.trim()) {\n\t\treturn RocketChat.API.v1.failure('Body param \"roomId\" is required');\n\t}\n\n\tconst roomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, userId);\n\n\tif (!roomSub || roomSub.t !== 'd') {\n\t\treturn RocketChat.API.v1.failure(`No direct message room found by the id of: ${roomId}`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute(['dm.close', 'im.close'], { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the dm or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${this.bodyParams.name}, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.history', 'im.history'], { authRequired: true }, {\n\tget: function() {\n\t\tconst findResult = findDirectMessageRoomById(this.queryParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages.others', 'im.messages.others'], { authRequired: true }, {\n\tget: function() {\n\t\tif (RocketChat.settings.get('API_Enable_Direct_Message_History_EndPoint') !== true) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/im.messages.others' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst roomId = this.queryParams.roomId;\n\t\tif (!roomId || !roomId.trim()) {\n\t\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\tif (!room || room.t !== 'd') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', `No direct message room found by the id of: ${roomId}`);\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { rid: room._id });\n\n\t\tconst msgs = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: msgs,\n\t\t\toffset,\n\t\t\tcount: msgs.length,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list', 'im.list'], { authRequired: true }, {\n\tget: function() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('d', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list.everyone', 'im.list.everyone'], { authRequired: true }, {\n\tget: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { t: 'd' });\n\n\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.open', 'im.open'], { authRequired: true }, {\n\tpost: function() {\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${this.bodyParams.name}, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.setTopic', 'im.setTopic'], { authRequired: true }, {\n\tpost: function() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('integrations.create', { authRequired: true }, {\n\tpost: function() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\turls: [String],\n\t\t\tchannel: String,\n\t\t\tevent: String,\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\talias: Match.Maybe(String),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\ttargetChannel: Match.Maybe(String)\n\t\t}));\n\n\t\tlet integration;\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addOutgoingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ integration });\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.history', { authRequired: true }, {\n\tget: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.queryParams.id || this.queryParams.id.trim() === '') {\n\t\t\treturn RocketChat.API.v1.failure('Invalid integration id.');\n\t\t}\n\n\t\tconst id = this.queryParams.id;\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { 'integration._id': id });\n\t\tconst history = RocketChat.models.IntegrationHistory.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\thistory,\n\t\t\toffset,\n\t\t\titems: history.length,\n\t\t\ttotal: RocketChat.models.IntegrationHistory.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.list', { authRequired: true }, {\n\tget: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations: integrations,\n\t\t\toffset,\n\t\t\titems: integrations.length,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.remove', { authRequired: true }, {\n\tpost: function() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\ttarget_url: Match.Maybe(String),\n\t\t\tintegrationId: Match.Maybe(String)\n\t\t}));\n\n\t\tif (!this.bodyParams.target_url && !this.bodyParams.integrationId) {\n\t\t\treturn RocketChat.API.v1.failure('An integrationId or target_url needs to be provided.');\n\t\t}\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tlet integration;\n\n\t\t\t\tif (this.bodyParams.target_url) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ urls: this.bodyParams.target_url });\n\t\t\t\t} else if (this.bodyParams.integrationId) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\t\t\t\t}\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteOutgoingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration: integration\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\t}\n});\n","RocketChat.API.v1.addRoute('info', { authRequired: false }, {\n\tget: function() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tinfo: {\n\t\t\t\t'version': RocketChat.Info.version\n\t\t\t}\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('me', { authRequired: true }, {\n\tget: function() {\n\t\treturn RocketChat.API.v1.success(_.pick(this.user, [\n\t\t\t'_id',\n\t\t\t'name',\n\t\t\t'emails',\n\t\t\t'status',\n\t\t\t'statusConnection',\n\t\t\t'username',\n\t\t\t'utcOffset',\n\t\t\t'active',\n\t\t\t'language'\n\t\t]));\n\t}\n});\n","// settings endpoints\nRocketChat.API.v1.addRoute('settings', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\tourQuery.public = true;\n\t\t}\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings/:_id', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(_.pick(RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id), '_id', 'value'));\n\t},\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'edit-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tvalue: Match.Any\n\t\t});\n\n\t\tif (RocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value)) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\treturn RocketChat.API.v1.failure();\n\t}\n});\n","RocketChat.API.v1.addRoute('statistics', { authRequired: true }, {\n\tget() {\n\t\tlet refresh = false;\n\t\tif (typeof this.queryParams.refresh !== 'undefined' && this.queryParams.refresh === 'true') {\n\t\t\trefresh = true;\n\t\t}\n\n\t\tlet stats;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tstats = Meteor.call('getStatistics', refresh);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics: stats\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('statistics.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-statistics')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\n\t\tconst statistics = RocketChat.models.Statistics.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics,\n\t\t\tcount: statistics.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Statistics.find(ourQuery).count()\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('users.create', { authRequired: true }, {\n\tpost: function() {\n\t\tcheck(this.bodyParams, {\n\t\t\temail: String,\n\t\t\tname: String,\n\t\t\tpassword: String,\n\t\t\tusername: String,\n\t\t\tactive: Match.Maybe(Boolean),\n\t\t\troles: Match.Maybe(Array),\n\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\tverified: Match.Maybe(Boolean),\n\t\t\tcustomFields: Match.Maybe(Object)\n\t\t});\n\n\t\t//New change made by pull request #5152\n\t\tif (typeof this.bodyParams.joinDefaultChannels === 'undefined') {\n\t\t\tthis.bodyParams.joinDefaultChannels = true;\n\t\t}\n\n\t\tconst newUserId = RocketChat.saveUser(this.userId, this.bodyParams);\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.saveCustomFields(newUserId, this.bodyParams.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', newUserId, this.bodyParams.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(newUserId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.delete', { authRequired: true }, {\n\tpost: function() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'delete-user')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUser', user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getAvatar', { authRequired: false }, {\n\tget: function() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tconst url = RocketChat.getURL(`/avatar/${user.username}`, { cdn: false, full: true });\n\t\tthis.response.setHeader('Location', url);\n\n\t\treturn {\n\t\t\tstatusCode: 307,\n\t\t\tbody: url\n\t\t};\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getPresence', { authRequired: true }, {\n\tget: function() {\n\t\t//BLAHHHHHHHHHH :'(\n\t\tif ((this.queryParams.userId && this.userId !== this.queryParams.userId) || (this.queryParams.username && this.user.username !== this.queryParams.username) || (this.queryParams.user && this.user.username !== this.queryParams.user)) {\n\t\t\tconst user = this.getUserFromParams();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpresence: user.status\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpresence: user.status,\n\t\t\tconnectionStatus: user.statusConnection,\n\t\t\tlastLogin: user.lastLogin\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.info', { authRequired: true }, {\n\tget: function() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getFullUserData', { filter: user.username, limit: 1 });\n\t\t});\n\n\t\tif (!result || result.length !== 1) {\n\t\t\treturn RocketChat.API.v1.failure(`Failed to get the user data for the userId of \"${user._id}\".`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: result[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.list', { authRequired: true }, {\n\tget: function() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet fieldsToKeepFromRegularUsers;\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info')) {\n\t\t\tfieldsToKeepFromRegularUsers = {\n\t\t\t\tavatarOrigin: 0,\n\t\t\t\temails: 0,\n\t\t\t\tphone: 0,\n\t\t\t\tstatusConnection: 0,\n\t\t\t\tcreatedAt: 0,\n\t\t\t\tlastLogin: 0,\n\t\t\t\tservices: 0,\n\t\t\t\trequirePasswordChange: 0,\n\t\t\t\trequirePasswordChangeReason: 0,\n\t\t\t\troles: 0,\n\t\t\t\tstatusDefault: 0,\n\t\t\t\t_updatedAt: 0,\n\t\t\t\tcustomFields: 0\n\t\t\t};\n\t\t}\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst ourFields = Object.assign({}, fields, fieldsToKeepFromRegularUsers, RocketChat.API.v1.defaultFieldsToExclude);\n\n\t\tconst users = RocketChat.models.Users.find(ourQuery, {\n\t\t\tsort: sort ? sort : { username: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: ourFields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tusers,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Users.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.register', { authRequired: false }, {\n\tpost: function() {\n\t\tif (this.userId) {\n\t\t\treturn RocketChat.API.v1.failure('Logged in users can not register again.');\n\t\t}\n\n\t\t//We set their username here, so require it\n\t\t//The `registerUser` checks for the other requirements\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tusername: String\n\t\t}));\n\n\t\t//Register the user\n\t\tconst userId = Meteor.call('registerUser', this.bodyParams);\n\n\t\t//Now set their username\n\t\tMeteor.runAsUser(userId, () => Meteor.call('setUsername', this.bodyParams.username));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\n//TODO: Make this route work with support for usernames\nRocketChat.API.v1.addRoute('users.setAvatar', { authRequired: true }, {\n\tpost: function() {\n\t\tcheck(this.bodyParams, { avatarUrl: Match.Maybe(String), userId: Match.Maybe(String) });\n\n\t\tif (typeof this.bodyParams.userId !== 'undefined' && this.userId !== this.bodyParams.userId && !RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = Meteor.users.findOne(this.bodyParams.userId ? this.bodyParams.userId : this.userId);\n\n\t\tif (this.bodyParams.avatarUrl) {\n\t\t\tRocketChat.setUserAvatar(user, this.bodyParams.avatarUrl, '', 'url');\n\t\t} else {\n\t\t\tconst Busboy = Npm.require('busboy');\n\t\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\n\t\t\tMeteor.wrapAsync((callback) => {\n\t\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\t\tif (fieldname !== 'image') {\n\t\t\t\t\t\treturn callback(new Meteor.Error('invalid-field'));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst imageData = [];\n\t\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\t\timageData.push(data);\n\t\t\t\t\t}));\n\n\t\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\tRocketChat.setUserAvatar(user, Buffer.concat(imageData), mimetype, 'rest');\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}));\n\n\t\t\t\t\tthis.request.pipe(busboy);\n\t\t\t\t}));\n\t\t\t})();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.update', { authRequired: true }, {\n\tpost: function() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: String,\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tpassword: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tactive: Match.Maybe(Boolean),\n\t\t\t\troles: Match.Maybe(Array),\n\t\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\t\tverified: Match.Maybe(Boolean),\n\t\t\t\tcustomFields: Match.Maybe(Object)\n\t\t\t})\n\t\t});\n\n\t\tconst userData = _.extend({ _id: this.bodyParams.userId }, this.bodyParams.data);\n\n\t\tRocketChat.saveUser(this.userId, userData);\n\n\t\tif (this.bodyParams.data.customFields) {\n\t\t\tRocketChat.saveCustomFields(this.bodyParams.userId, this.bodyParams.data.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.data.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', this.bodyParams.userId, this.bodyParams.data.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n","RocketChat.API.default.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","RocketChat.API.default.addRoute('info', { authRequired: false }, {\n\tget: function() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tversion: RocketChat.Info.version\n\t\t});\n\t}\n});\n","RocketChat.API.default.addRoute('metrics', { authRequired: false }, {\n\tget:\tfunction() {\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'text/plain' },\n\t\t\tbody: RocketChat.promclient.register.metrics()\n\t\t};\n\t}\n});\n"]}
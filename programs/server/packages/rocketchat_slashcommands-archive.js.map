{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-archive/messages.js","meteor://ðŸ’»app/packages/rocketchat:slashcommands-archive/server.js"],"names":["RocketChat","models","Messages","createRoomArchivedByRoomIdAndUser","roomId","user","createWithTypeRoomIdMessageAndUser","Archive","command","params","item","channel","room","Match","test","String","trim","Rooms","findOneById","rid","name","replace","findOneByName","Meteor","users","findOne","userId","archived","Notifications","notifyUser","_id","Random","id","ts","Date","msg","TAPi18n","__","postProcess","sprintf","language","call","slashCommands","add"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,WAAWC,MAAX,CAAkBC,QAAlB,CAA2BC,iCAA3B,GAA+D,UAASC,MAAT,EAAiBC,IAAjB,EAAuB;AACrF,QAAO,KAAKC,kCAAL,CAAwC,eAAxC,EAAyDF,MAAzD,EAAiE,EAAjE,EAAqEC,IAArE,CAAP;AACA,CAFD,4F;;;;;;;;;;;ACAA,SAASE,OAAT,CAAiBC,OAAjB,EAA0BC,MAA1B,EAAkCC,IAAlC,EAAwC;AACvC,KAAIC,OAAJ,EAAaC,IAAb,EAAmBP,IAAnB;;AACA,KAAIG,YAAY,SAAZ,IAAyB,CAACK,MAAMC,IAAN,CAAWL,MAAX,EAAmBM,MAAnB,CAA9B,EAA0D;AACzD;AACA;;AACDJ,WAAUF,OAAOO,IAAP,EAAV;;AACA,KAAIL,YAAY,EAAhB,EAAoB;AACnBC,SAAOZ,WAAWC,MAAX,CAAkBgB,KAAlB,CAAwBC,WAAxB,CAAoCR,KAAKS,GAAzC,CAAP;AACAR,YAAUC,KAAKQ,IAAf;AACA,EAHD,MAGO;AACNT,YAAUA,QAAQU,OAAR,CAAgB,GAAhB,EAAqB,EAArB,CAAV;AACAT,SAAOZ,WAAWC,MAAX,CAAkBgB,KAAlB,CAAwBK,aAAxB,CAAsCX,OAAtC,CAAP;AACA;;AACDN,QAAOkB,OAAOC,KAAP,CAAaC,OAAb,CAAqBF,OAAOG,MAAP,EAArB,CAAP;;AAEA,KAAId,KAAKe,QAAT,EAAmB;AAClB3B,aAAW4B,aAAX,CAAyBC,UAAzB,CAAoCN,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DI,QAAKC,OAAOC,EAAP,EAD0D;AAE/Db,QAAKT,KAAKS,GAFqD;AAG/Dc,OAAI,IAAIC,IAAJ,EAH2D;AAI/DC,QAAKC,QAAQC,EAAR,CAAW,iCAAX,EAA8C;AAClDC,iBAAa,SADqC;AAElDC,aAAS,CAAC5B,OAAD;AAFyC,IAA9C,EAGFN,KAAKmC,QAHH;AAJ0D,GAAhE;AASA;AACA;;AACDjB,QAAOkB,IAAP,CAAY,aAAZ,EAA2B7B,KAAKkB,GAAhC;AAEA9B,YAAWC,MAAX,CAAkBC,QAAlB,CAA2BC,iCAA3B,CAA6DS,KAAKkB,GAAlE,EAAuEP,OAAOlB,IAAP,EAAvE;AACAL,YAAW4B,aAAX,CAAyBC,UAAzB,CAAoCN,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DI,OAAKC,OAAOC,EAAP,EAD0D;AAE/Db,OAAKT,KAAKS,GAFqD;AAG/Dc,MAAI,IAAIC,IAAJ,EAH2D;AAI/DC,OAAKC,QAAQC,EAAR,CAAW,kBAAX,EAA+B;AACnCC,gBAAa,SADsB;AAEnCC,YAAS,CAAC5B,OAAD;AAF0B,GAA/B,EAGFN,KAAKmC,QAHH;AAJ0D,EAAhE;AAUA,QAAOjC,OAAP;AACA;;AAEDP,WAAW0C,aAAX,CAAyBC,GAAzB,CAA6B,SAA7B,EAAwCpC,OAAxC,+C","file":"/packages/rocketchat_slashcommands-archive.js","sourcesContent":["RocketChat.models.Messages.createRoomArchivedByRoomIdAndUser = function(roomId, user) {\n\treturn this.createWithTypeRoomIdMessageAndUser('room-archived', roomId, '', user);\n};\n","function Archive(command, params, item) {\n\tvar channel, room, user;\n\tif (command !== 'archive' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\tchannel = params.trim();\n\tif (channel === '') {\n\t\troom = RocketChat.models.Rooms.findOneById(item.rid);\n\t\tchannel = room.name;\n\t} else {\n\t\tchannel = channel.replace('#', '');\n\t\troom = RocketChat.models.Rooms.findOneByName(channel);\n\t}\n\tuser = Meteor.users.findOne(Meteor.userId());\n\n\tif (room.archived) {\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date(),\n\t\t\tmsg: TAPi18n.__('Duplicate_archived_channel_name', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [channel]\n\t\t\t}, user.language)\n\t\t});\n\t\treturn;\n\t}\n\tMeteor.call('archiveRoom', room._id);\n\n\tRocketChat.models.Messages.createRoomArchivedByRoomIdAndUser(room._id, Meteor.user());\n\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t_id: Random.id(),\n\t\trid: item.rid,\n\t\tts: new Date(),\n\t\tmsg: TAPi18n.__('Channel_Archived', {\n\t\t\tpostProcess: 'sprintf',\n\t\t\tsprintf: [channel]\n\t\t}, user.language)\n\t});\n\n\treturn Archive;\n}\n\nRocketChat.slashCommands.add('archive', Archive);\n"]}
{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-create/server.js"],"names":["Create","command","params","item","getParams","str","regex","result","m","exec","index","lastIndex","push","channel","room","user","regexp","Match","test","String","trim","Meteor","users","findOne","userId","RocketChat","models","Rooms","findOneByName","Notifications","notifyUser","_id","Random","id","rid","ts","Date","msg","TAPi18n","__","postProcess","sprintf","language","indexOf","call","slashCommands","add"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,MAAT,CAAgBC,OAAhB,EAAyBC,MAAzB,EAAiCC,IAAjC,EAAuC;AACtC,UAASC,SAAT,CAAmBC,GAAnB,EAAwB;AACvB,MAAMC,QAAQ,aAAd;AACA,MAAMC,SAAS,EAAf;AACA,MAAIC,UAAJ;;AACA,SAAO,CAACA,IAAIF,MAAMG,IAAN,CAAWJ,GAAX,CAAL,MAA0B,IAAjC,EAAuC;AACtC,OAAIG,EAAEE,KAAF,KAAYJ,MAAMK,SAAtB,EAAiC;AAChCL,UAAMK,SAAN;AACA;;AACDJ,UAAOK,IAAP,CAAYJ,EAAE,CAAF,CAAZ;AACA;;AACD,SAAOD,MAAP;AACA;;AACD,KAAIM,OAAJ,EAAaC,IAAb,EAAmBC,IAAnB;AACA,KAAIC,SAAS,gBAAb;;AACA,KAAIf,YAAY,QAAZ,IAAwB,CAACgB,MAAMC,IAAN,CAAWhB,MAAX,EAAmBiB,MAAnB,CAA7B,EAAyD;AACxD;AACA;;AACDN,WAAUG,OAAOP,IAAP,CAAYP,OAAOkB,IAAP,EAAZ,CAAV;AACAP,WAAUA,UAAUA,QAAQ,CAAR,CAAV,GAAuB,EAAjC;;AACA,KAAIA,YAAY,EAAhB,EAAoB;AACnB;AACA;;AAEDE,QAAOM,OAAOC,KAAP,CAAaC,OAAb,CAAqBF,OAAOG,MAAP,EAArB,CAAP;AACAV,QAAOW,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,aAAxB,CAAsCf,OAAtC,CAAP;;AACA,KAAIC,QAAQ,IAAZ,EAAkB;AACjBW,aAAWI,aAAX,CAAyBC,UAAzB,CAAoCT,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DO,QAAKC,OAAOC,EAAP,EAD0D;AAE/DC,QAAK/B,KAAK+B,GAFqD;AAG/DC,OAAI,IAAIC,IAAJ,EAH2D;AAI/DC,QAAKC,QAAQC,EAAR,CAAW,uBAAX,EAAoC;AACxCC,iBAAa,SAD2B;AAExCC,aAAS,CAAC5B,OAAD;AAF+B,IAApC,EAGFE,KAAK2B,QAHH;AAJ0D,GAAhE;AASA;AACA;;AAED,KAAItC,UAAUF,MAAV,EAAkByC,OAAlB,CAA0B,SAA1B,IAAuC,CAAC,CAA5C,EAA+C;AAC9C,SAAOtB,OAAOuB,IAAP,CAAY,oBAAZ,EAAkC/B,OAAlC,EAA2C,EAA3C,CAAP;AACA;;AAEDQ,QAAOuB,IAAP,CAAY,eAAZ,EAA6B/B,OAA7B,EAAsC,EAAtC;AACA;;AAEDY,WAAWoB,aAAX,CAAyBC,GAAzB,CAA6B,QAA7B,EAAuC9C,MAAvC,6B","file":"/packages/rocketchat_slashcommands-create.js","sourcesContent":["function Create(command, params, item) {\n\tfunction getParams(str) {\n\t\tconst regex = /(--(\\w+))+/g;\n\t\tconst result = [];\n\t\tlet m;\n\t\twhile ((m = regex.exec(str)) !== null) {\n\t\t\tif (m.index === regex.lastIndex) {\n\t\t\t\tregex.lastIndex++;\n\t\t\t}\n\t\t\tresult.push(m[2]);\n\t\t}\n\t\treturn result;\n\t}\n\tvar channel, room, user;\n\tvar regexp = /#?([\\d-_\\w]+)/g;\n\tif (command !== 'create' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\tchannel = regexp.exec(params.trim());\n\tchannel = channel ? channel[1] : '';\n\tif (channel === '') {\n\t\treturn;\n\t}\n\n\tuser = Meteor.users.findOne(Meteor.userId());\n\troom = RocketChat.models.Rooms.findOneByName(channel);\n\tif (room != null) {\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date(),\n\t\t\tmsg: TAPi18n.__('Channel_already_exist', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [channel]\n\t\t\t}, user.language)\n\t\t});\n\t\treturn;\n\t}\n\n\tif (getParams(params).indexOf('private') > -1) {\n\t\treturn Meteor.call('createPrivateGroup', channel, []);\n\t}\n\n\tMeteor.call('createChannel', channel, []);\n}\n\nRocketChat.slashCommands.add('create', Create);\n"]}
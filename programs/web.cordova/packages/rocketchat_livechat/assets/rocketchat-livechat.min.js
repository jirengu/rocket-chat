!function(t){"use strict";function e(){}function n(t,e){for(var n=t.length;n--;)if(t[n].listener===e)return n;return-1}function i(t){return function(){return this[t].apply(this,arguments)}}function o(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&o(t.listener)}var r=e.prototype,s=t.EventEmitter;r.getListeners=function(t){var e,n,i=this._getEvents();if(t instanceof RegExp){e={};for(n in i)i.hasOwnProperty(n)&&t.test(n)&&(e[n]=i[n])}else e=i[t]||(i[t]=[]);return e},r.flattenListeners=function(t){var e,n=[];for(e=0;e<t.length;e+=1)n.push(t[e].listener);return n},r.getListenersAsObject=function(t){var e,n=this.getListeners(t);return n instanceof Array&&(e={},e[t]=n),e||n},r.addListener=function(t,e){if(!o(e))throw new TypeError("listener must be a function");var i,r=this.getListenersAsObject(t),s="object"==typeof e;for(i in r)r.hasOwnProperty(i)&&n(r[i],e)===-1&&r[i].push(s?e:{listener:e,once:!1});return this},r.on=i("addListener"),r.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},r.once=i("addOnceListener"),r.defineEvent=function(t){return this.getListeners(t),this},r.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},r.removeListener=function(t,e){var i,o,r=this.getListenersAsObject(t);for(o in r)r.hasOwnProperty(o)&&(i=n(r[o],e),i!==-1&&r[o].splice(i,1));return this},r.off=i("removeListener"),r.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},r.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},r.manipulateListeners=function(t,e,n){var i,o,r=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(i=n.length;i--;)r.call(this,e,n[i]);else for(i in e)e.hasOwnProperty(i)&&(o=e[i])&&("function"==typeof o?r.call(this,i,o):s.call(this,i,o));return this},r.removeEvent=function(t){var e,n=typeof t,i=this._getEvents();if("string"===n)delete i[t];else if(t instanceof RegExp)for(e in i)i.hasOwnProperty(e)&&t.test(e)&&delete i[e];else delete this._events;return this},r.removeAllListeners=i("removeEvent"),r.emitEvent=function(t,e){var n,i,o,r,s,a=this.getListenersAsObject(t);for(r in a)if(a.hasOwnProperty(r))for(n=a[r].slice(0),o=0;o<n.length;o++)i=n[o],i.once===!0&&this.removeListener(t,i.listener),s=i.listener.apply(this,e||[]),s===this._getOnceReturnValue()&&this.removeListener(t,i.listener);return this},r.trigger=i("emitEvent"),r.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},r.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},r._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return t.EventEmitter=s,e},"object"==typeof module&&module.exports?module.exports=e:t.EventEmitter=e}(this||{}),function(t){t.RocketChat=t.RocketChat||{_:[]};var e,n,i={},o=[],r=!1,s="320px",a="350px",c="30px",u=["chat-maximized","chat-minimized","chat-started","chat-ended","pre-chat-form-submit","offline-form-submit"],d=new EventEmitter,f=function(t,e){return u.indexOf(t)!==-1&&d.on(t,e)},l=function(t,e){"undefined"!=typeof e?d.emit(t,e):d.emit(t)},h=function(t,e){if(!r)return o.push(arguments);var i={src:"rocketchat",fn:t,args:e};n.contentWindow.postMessage(i,"*")},m=function(){"closed"!==e.dataset.state&&(e.dataset.state="closed",e.style.height=c,h("widgetClosed"),l("chat-minimized"))},p=function(){"opened"!==e.dataset.state&&(e.dataset.state="opened",e.style.height=a,h("widgetOpened"),document.querySelector(".rocketchat-widget iframe").focus(),l("chat-maximized"))},v={ready:function(){r=!0,o.length>0&&(o.forEach(function(t){h.apply(this,t)}),o=[])},toggleWindow:function(){"closed"===e.dataset.state?p():m()},openPopout:function(){m();var t=window.open(i.url+"?mode=popout","livechat-popout","width=400, height=450, toolbars=no");t.focus()},openWidget:function(){p()},removeWidget:function(){document.getElementsByTagName("body")[0].removeChild(e)},callback:function(t,e){l(t,e)}},g=function(t){h("pageVisited",{change:t,location:JSON.parse(JSON.stringify(document.location)),title:document.title})},y=function(t,e,n){"undefined"==typeof n&&(n=!0),h("setCustomField",[t,e,n])},w=function(t){h("setTheme",t)},E=function(t){h("setDepartment",t)},L=function(){h("clearDepartment")},R={href:null,title:null},b=function(){setInterval(function(){document.location.href!==R.href&&(g("url"),R.href=document.location.href),document.title!==R.title&&(g("title"),R.title=document.title)},800)},k=function(o){if(o){i.url=o;var r=document.createElement("div");r.dataset.state="closed",r.className="rocketchat-widget",r.innerHTML='<div class="rocketchat-container" style="width:100%;height:100%"><iframe id="rocketchat-iframe" src="'+o+'" style="width:100%;height:100%;border:none;background-color:transparent" allowTransparency="true"></iframe> </div><div class="rocketchat-overlay"></div>',r.style.position="fixed",r.style.width=s,r.style.height=c,r.style.borderTopLeftRadius="5px",r.style.borderTopRightRadius="5px",r.style.bottom="0",r.style.right="50px",r.style.zIndex="12345",document.getElementsByTagName("body")[0].appendChild(r),e=document.querySelector(".rocketchat-widget"),n=document.getElementById("rocketchat-iframe"),t.addEventListener("message",function(t){if("object"==typeof t.data&&void 0!==t.data.src&&"rocketchat"===t.data.src&&void 0!==v[t.data.fn]&&"function"==typeof v[t.data.fn]){var e=[].concat(t.data.args||[]);v[t.data.fn].apply(null,e)}},!1);var a=function(t){t.matches?(r.style.left="0",r.style.right="0",r.style.width="100%"):(r.style.left="auto",r.style.right="50px",r.style.width=s)},u=window.matchMedia("screen and (max-device-width: 480px) and (orientation: portrait)");a(u),u.addListener(a),b()}};"undefined"!=typeof t.initRocket&&(console.warn("initRocket is now deprecated. Please update the livechat code."),k(t.initRocket[0])),"undefined"!=typeof t.RocketChat.url&&k(t.RocketChat.url);var x=t.RocketChat._;t.RocketChat=t.RocketChat._.push=function(e){e.call(t.RocketChat.livechat)},t.RocketChat.livechat={pageVisited:g,setCustomField:y,setTheme:w,setDepartment:E,clearDepartment:L,onChatMaximized:function(t){f("chat-maximized",t)},onChatMinimized:function(t){f("chat-minimized",t)},onChatStarted:function(t){f("chat-started",t)},onChatEnded:function(t){f("chat-ended",t)},onPrechatFormSubmit:function(t){f("pre-chat-form-submit",t)},onOfflineFormSubmit:function(t){f("offline-form-submit",t)}},x.forEach(function(e){e.call(t.RocketChat.livechat)})}(window);